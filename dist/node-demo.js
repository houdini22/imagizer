(()=>{var t={75:(t,e,r)=>{(()=>{"use strict";var e={338:t=>{t.exports=r(338)},747:t=>{t.exports=r(747)}},n={};function o(t){var r=n[t];if(void 0!==r)return r.exports;var i=n[t]={exports:{}};return e[t](i,i.exports,o),i.exports}o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};(()=>{o.r(i),o.d(i,{Image:()=>La,Project:()=>Ea});var t={lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return t*e/255},average:function(t,e){return t+e/2},add:function(t,e){return Math.min(255,t+e)},subtract:function(t,e){return t+e<255?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-2*t*e/255},overlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},softLight:function(t,e){return e<128?2*(64+(t>>1))*(e/255):255-2*(255-(64+(t>>1)))*(255-e)/255},hardLight:function(e,r){return t.softLight(r,e)},colorDodge:function(t,e){return 255===e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0===e?e:Math.max(0,255-(255-t<<8)/e)},linearDodge:function(e,r){return t.add(e,r)},linearBurn:function(e,r){return t.subtract(e,r)},linearLight:function(e,r){return r<128?t.linearBurn(e,2*r):t.linearDodge(e,2*(r-128))},vividLight:function(e,r){return r<128?t.colorBurn(e,2*r):t.colorDodge(e,2*(r-128))},pinLight:function(e,r){return r<128?t.darken(e,2*r):t.lighten(e,2*(r-128))},hardMix:function(e,r){return t.vividLight(e,r)<128?0:255},reflect:function(t,e){return 255===e?e:Math.min(255,t*t/(255-e))},glow:function(e,r){return t.reflect(r,e)},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}};function e(t,e,r){var n,o,i,a,u,c,f;for(o=e.y,a=0;o<t.height&&a<e.height;o+=1,a+=1)for(n=e.x,i=0;n<t.width&&i<e.width;n+=1,i+=1)i<e.width&&a<e.height&&(u=o*t.width*4+4*n,c=a*e.width*4+4*i,!1!==(f=r({r:t.imageData.data[u+0],g:t.imageData.data[u+1],b:t.imageData.data[u+2],a:t.imageData.data[u+3]},{r:e.imageData.data[c+0],g:e.imageData.data[c+1],b:e.imageData.data[c+2],a:e.imageData.data[c+3]},n,o,{blendingMode:e.blendingMode}))&&(t.imageData.data[u+0]=f.r,t.imageData.data[u+1]=f.g,t.imageData.data[u+2]=f.b,t.imageData.data[u+3]=f.a));return t.imageData}function r(e,r,n,o,i){if(0===r.a)return!1;var a,u,c,f=r.a/255,l=e.a/255*(1-f),s=f+e.a*(1-f)/255;switch(i.blendingMode){case"lighten":case"darken":case"multiply":case"average":case"add":case"subtract":case"difference":case"negation":case"screen":case"exclusion":case"overlay":case"softLight":case"hardLight":case"colorDodge":case"colorBurn":case"linearDodge":case"linearBurn":case"linearLight":case"vividLight":case"pinLight":case"hardMix":case"reflect":case"glow":case"phoenix":r.r=t[i.blendingMode](e.r,r.r),r.g=t[i.blendingMode](e.g,r.g),r.b=t[i.blendingMode](e.b,r.b)}var y=e.r,p=e.g,h=e.b;return a=r.r*f+y*l,u=r.g*f+p*l,c=r.b*f+h*l,a=0===s?0:a/s,u=0===s?0:u/s,c=0===s?0:c/s,{r:0|Math.min(Math.max(0,a),255),g:0|Math.min(Math.max(0,u),255),b:0|Math.min(Math.max(0,c),255),a:255*s|0}}function n(t,e){return(t-=Math.floor(t/e)*e)<0?t+e:t}function a(t){var e=n(t,1);return 2*(e<.5?e:1-e)}function u(t){return(t.r+t.g+t.b)/3}function c(){return"undefined"!=typeof window}function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const l=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,"canvas",null),f(this,"context",null),f(this,"width",0),f(this,"height",0),this.initialize(e,r)}var e;return(e=[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(c())this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="-99999px",this.canvas.style.top="-99999px",this.setWidth(t),this.setHeight(e),document.body.appendChild(this.canvas);else{var r=o(338),n=r.createCanvas;this.canvas=n(t,e)}}},{key:"setWidth",value:function(t){return this.canvas.setAttribute("width",""+t),this.width=t,this}},{key:"setHeight",value:function(t){return this.canvas.setAttribute("height",""+t),this.height=t,this}},{key:"getContext",value:function(){return this.context||(this.context=this.canvas.getContext("2d")),this.context}},{key:"getCanvas",value:function(){return this.canvas}},{key:"toDataURL",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";return this.canvas.toDataURL(t)}},{key:"destroy",value:function(){c()&&document.body.removeChild(this.canvas),this.canvas=null,this.context=null}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}();function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),p(this,"opts",{}),this.opts=e}var e,r,n;return e=t,n=[{key:"getName",value:function(){throw"Extend it."}}],(r=[{key:"getDefaultParameters",value:function(){return{}}},{key:"before",value:function(t,e,r,n){return{}}},{key:"run",value:function(t,e){return null}}])&&y(e.prototype,r),n&&y(e,n),t}();function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){m(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t,e){if(e&&("object"===b(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=P(r);if(n){var o=P(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return O(this,t)});function i(){return g(this,i),o.apply(this,arguments)}return(e=[{key:"callback",value:function(t,e,r,n,o,i){throw"Extend it."}},{key:"run",value:function(t,e){var r,n,o,i;e=e=v(v({},this.getDefaultParameters()),e);var a=new Uint8ClampedArray(t.data),u=function(e,r){return r*t.width*4+4*e},c=function(t){return 0|Math.min(Math.max(t,0),255)},f={getPixel:function(t,e){var r=u(t,e);return{r:a[r+0],g:a[r+1],b:a[r+2],a:a[r+3]}},getOriginalPixel:function(e,r){var n=u(e,r);return{r:t.data[n+0],g:t.data[n+1],b:t.data[n+2],a:t.data[n+3]}},setPixel:function(t,e,r){var n=u(t,e);a[n+0]=c(r.r),a[n+1]=c(r.g),a[n+2]=c(r.b),a[n+3]=c(r.a)},data:null,width:t.width,height:t.height};for(f.data=this.before.call(f,e,t.width,t.height,t),n=0;n<t.height;n+=1)for(r=0;r<t.width;r+=1)o=u(r,n),"object"===b(i=this.callback.call(f,{r:a[o+0],g:a[o+1],b:a[o+2],a:a[o+3]},r,n,e,t.width,t.height))&&(a[o+0]=c(i.r),a[o+1]=c(i.g),a[o+2]=c(i.b),a[o+3]=c(i.a));return t.data.set(a),t}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(i.prototype,e),i}(h);function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t,e){if(e&&("object"===_(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=M(o);if(i){var r=M(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return x(this,t)});function u(){return k(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"gray-scale"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){var a=.299*t.r+.587*t.g+.114*t.b;return{r:a,g:a,b:a,a:t.a}}}])&&S(e.prototype,r),n&&S(e,n),u}(j);function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function I(t,e){if(e&&("object"===B(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=X(o);if(i){var r=X(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return I(this,t)});function u(){return D(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"sepia"}}],(r=[{key:"getDefaultParameters",value:function(){return{sepiaValue:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=.299*t.r+.587*t.g+.114*t.b;return t.r=a+2*n.sepiaValue,t.g=a+n.sepiaValue,t.b=a,t}}])&&T(e.prototype,r),n&&T(e,n),u}(j);function A(t){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function q(t,e){if(e&&("object"===A(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return H(t)}function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function W(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const F=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=z(o);if(i){var r=z(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return q(this,t)});function u(){var t;N(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return W(H(t=a.call.apply(a,[this].concat(r))),"data",{factor:1}),t}return e=u,n=[{key:"getName",value:function(){return"contrast"}}],(r=[{key:"getDefaultParameters",value:function(){return{contrast:.5}}},{key:"before",value:function(t){return{factor:259*(255*t.contrast+255)/(255*(259-255*t.contrast))}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=this.data.factor*(t.r-128)+128,t.g=this.data.factor*(t.g-128)+128,t.b=this.data.factor*(t.b-128)+128,t}}])&&G(e.prototype,r),n&&G(e,n),u}(j);function V(t){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function J(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Q(t,e){if(e&&("object"===V(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Z(t)}function Z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$(o);if(i){var r=$(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Q(this,t)});function u(){var t;U(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return tt(Z(t=a.call.apply(a,[this].concat(r))),"data",{brightness:0}),t}return e=u,n=[{key:"getName",value:function(){return"brightness"}}],(r=[{key:"getDefaultParameters",value:function(){return{brightness:.5}}},{key:"before",value:function(t){return{brightness:255*t.brightness}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=t.r+this.data.brightness,t.g=t.g+this.data.brightness,t.b=t.b+this.data.brightness,t}}])&&J(e.prototype,r),n&&J(e,n),u}(j);function rt(t){return(rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function at(t,e){if(e&&("object"===rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ut(t)}function ut(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ft(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ct(o);if(i){var r=ct(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return at(this,t)});function u(){var t;nt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ft(ut(t=a.call.apply(a,[this].concat(r))),"data",{map:{},div:{},sum:0}),t}return e=u,n=[{key:"getName",value:function(){return"diffusion"}}],(r=[{key:"getDefaultParameters",value:function(){return{matrix:[0,0,0,0,0,7,3,5,1],levels:6,colorDither:!0,granulate:!0}}},{key:"before",value:function(t,e,r,n){var o,i=0,a=[],u=[];for(o=0;o<t.matrix.length;o+=1)i+=t.matrix[o];for(o=0;o<t.levels;o+=1)a[o]=255*o/(t.levels-1)|0;for(o=0;o<256;o+=1)u[o]=t.levels*o/256|0;return{sum:i,map:a,div:u}}},{key:"callback",value:function(t,e,r,n,o,i){var a,u,c,f,l,s,y,p,h,b,d,v,m,g=t.r,w=t.g,O=t.b,P=this.data;if(n.colorDither||(g=m=(g+w+O)/3,w=m,O=m),l=g-(a=P.map[P.div[g]]),s=w-(u=P.map[P.div[w]]),y=O-(c=P.map[P.div[O]]),n.granulate)for(p=-1;p<=1;p+=1)if(!((b=p+r)<0||b>=i))for(h=-1;h<=1;h+=1)(d=h+e)<0||d>=o||0!==(v=n.matrix[3*(p+1)+h+1])&&((f=this.getPixel(d,b)).r+=l*v/P.sum,f.g+=s*v/P.sum,f.b+=y*v/P.sum,this.setPixel(d,b,f));return{r:a,g:u,b:c,a:t.a}}}])&&ot(e.prototype,r),n&&ot(e,n),u}(j);function st(t){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ht(t,e){return(ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bt(t,e){if(e&&("object"===st(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return dt(t)}function dt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vt(t){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const gt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ht(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vt(o);if(i){var r=vt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return bt(this,t)});function u(){var t;yt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return mt(dt(t=a.call.apply(a,[this].concat(r))),"data",{cols:0,rows:0,map:{},mod:{},div:{}}),t}return e=u,n=[{key:"getName",value:function(){return"dither"}}],(r=[{key:"getDefaultParameters",value:function(){return{matrices:{ditherMagic4x4Matrix:[0,14,3,13,11,5,8,6,12,2,15,1,7,9,4,10],ditherOrdered4x4Matrix:[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],ditherLines4x4Matrix:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],dither90Halftone6x6Matrix:[29,18,12,19,30,34,17,7,4,8,20,28,11,3,0,1,9,27,16,6,2,5,13,26,25,15,10,14,21,31,33,25,24,23,33,36],ditherOrdered6x6Matrix:[1,59,15,55,2,56,12,52,33,17,47,31,34,18,44,28,9,49,5,63,10,50,6,60,41,25,37,21,42,26,38,22,3,57,13,53,0,58,14,54,35,19,45,29,32,16,46,30,11,51,7,61,8,48,4,62,43,27,39,23,40,24,36,20],ditherOrdered8x8Matrix:[1,235,59,219,15,231,55,215,2,232,56,216,12,228,52,212,129,65,187,123,143,79,183,119,130,66,184,120,140,76,180,116,33,193,17,251,47,207,31,247,34,194,18,248,44,204,28,244,161,97,145,81,175,111,159,95,162,98,146,82,172,108,156,92,9,225,49,209,5,239,63,223,10,226,50,210,6,236,60,220,137,73,177,113,133,69,191,127,138,74,178,114,134,70,188,124,41,201,25,241,37,197,21,255,42,202,26,242,38,198,22,252,169,105,153,89,165,101,149,85,170,106,154,90,166,102,150,86,3,233,57,217,13,229,53,213,0,234,58,218,14,230,54,214,131,67,185,121,141,77,181,117,128,64,186,122,142,78,182,118,35,195,19,249,45,205,29,245,32,192,16,250,46,206,30,246,163,99,147,83,173,109,157,93,160,96,144,80,174,110,158,94,11,227,51,211,7,237,61,221,8,224,48,208,4,238,62,222,139,75,179,115,135,71,189,125,136,72,176,112,132,68,190,126,43,203,27,243,39,199,23,253,40,200,24,240,36,196,20,254,171,107,155,91,167,103,151,87,168,104,152,88,164,100,148,84],ditherCluster3Matrix:[9,11,10,8,6,7,12,17,16,5,0,1,13,14,15,4,3,2,8,6,7,9,11,10,5,0,1,12,17,16,4,3,2,13,14,15],ditherCluster4Matrix:[18,20,19,16,13,11,12,15,27,28,29,22,4,3,2,9,26,31,30,21,5,0,1,10,23,25,24,17,8,6,7,14,13,11,12,15,18,20,19,16,4,3,2,9,27,28,29,22,5,0,1,10,26,31,30,21,8,6,7,14,23,25,24,17],ditherCluster8Matrix:[64,69,77,87,86,76,68,67,63,58,50,40,41,51,59,60,70,94,100,109,108,99,93,75,57,33,27,18,19,28,34,52,78,101,114,116,115,112,98,83,49,26,13,11,12,15,29,44,88,110,123,124,125,118,107,85,39,17,4,3,2,9,20,42,89,111,122,127,126,117,106,84,38,16,5,0,1,10,21,43,79,102,119,121,120,113,97,82,48,25,8,6,7,14,30,45,71,95,103,104,105,96,92,74,56,32,24,23,22,31,35,53,65,72,80,90,91,81,73,66,62,55,47,37,36,46,54,61,63,58,50,40,41,51,59,60,64,69,77,87,86,76,68,67,57,33,27,18,19,28,34,52,70,94,100,109,108,99,93,75,49,26,13,11,12,15,29,44,78,101,114,116,115,112,98,83,39,17,4,3,2,9,20,42,88,110,123,124,125,118,107,85,38,16,5,0,1,10,21,43,89,111,122,127,126,117,106,84,48,25,8,6,7,14,30,45,79,102,119,121,120,113,97,82,56,32,24,23,22,31,35,53,71,95,103,104,105,96,92,74,62,55,47,37,36,46,54,61,65,72,80,90,91,81,73,66]},levels:6,matrix:"ditherMagic4x4Matrix",colorDither:!0}}},{key:"before",value:function(t,e,r,n){var o,i,a,u=t.matrix,c=[],f=[],l=[];for("string"==typeof u&&(u=t.matrices[u]),o=Math.sqrt(u.length),i=Math.sqrt(u.length),a=0;a<t.levels;a+=1)c[a]=255*a/(t.levels-1);for(a=0;a<256;a+=1)f[a]=(t.levels-1)*a/256|0,l[a]=a*(o*i+1)/256|0;return{matrix:u,map:c,div:f,mod:l,cols:i,rows:o}}},{key:"callback",value:function(t,e,r,n,o,i){var a,u=e%this.data.cols,c=r%this.data.rows,f=n.matrix[c*this.data.cols+u],l=t.r,s=t.g,y=t.b,p={a:t.a,r:0,g:0,b:0};return n.colorDither?(p.r=this.data.map[this.data.mod[l]>f?this.data.div[l]+1:this.data.div[l]],p.g=this.data.map[this.data.mod[s]>f?this.data.div[s]+1:this.data.div[s]],p.b=this.data.map[this.data.mod[y]>f?this.data.div[y]+1:this.data.div[y]]):(a=(l+s+y)/3,p.r=p.g=p.b=this.data.map[this.data.mod[a]>f?this.data.div[a]+1:this.data.div[a]]),p}}])&&pt(e.prototype,r),n&&pt(e,n),u}(j);function wt(t){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function jt(t,e){return(jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _t(t,e){if(e&&("object"===wt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const St=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kt(o);if(i){var r=kt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _t(this,t)});function u(){return Ot(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"exposure"}}],(r=[{key:"getDefaultParameters",value:function(){return{exposure:1}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=255*(1-Math.exp(-t.r/255*n.exposure)),t.g=255*(1-Math.exp(-t.g/255*n.exposure)),t.b=255*(1-Math.exp(-t.b/255*n.exposure)),t}}])&&Pt(e.prototype,r),n&&Pt(e,n),u}(j);function Rt(t){return(Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Et(t,e){return(Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Bt(t,e){if(e&&("object"===Rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Dt(t){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Et(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Dt(o);if(i){var r=Dt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Bt(this,t)});function u(){return xt(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"gain"}}],(r=[{key:"getDefaultParameters",value:function(){return{gain:1,bias:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=(1/n.gain-2)*(1-2*t.r/255),u=(1/n.gain-2)*(1-2*t.g/255),c=(1/n.gain-2)*(1-2*t.b/255);return a=t.r/255<.5?t.r/255/a+1:(a-t.r/255)/(a-1),u=t.g/255<.5?t.g/255/u+1:(u-t.g/255)/(u-1),c=t.b/255<.5?t.b/255/c+1:(c-t.b/255)/(c-1),a/=(1/n.bias-2)*(1-a)+1,u/=(1/n.bias-2)*(1-u)+1,c/=(1/n.bias-2)*(1-c)+1,t.r=255*a,t.g=255*u,t.b=255*c,t}}])&&Mt(e.prototype,r),n&&Mt(e,n),u}(j);function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yt(t,e){return(Yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function At(t,e){if(e&&("object"===Ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Nt(t)}function Nt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Gt(t){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Gt(o);if(i){var r=Gt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return At(this,t)});function u(){var t;It(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Lt(Nt(t=a.call.apply(a,[this].concat(r))),"data",{table:{r:{},g:{},b:{}}}),t}return e=u,n=[{key:"getName",value:function(){return"gamma"}}],(r=[{key:"getDefaultParameters",value:function(){return{gammaRed:1,gammaGreen:1,gammaBlue:1}}},{key:"before",value:function(t,e,r,n){var o,i={r:[],g:[],b:[]};for(o=0;o<256;o+=1)i.r[o]=255*Math.pow(o/255,1/t.gammaRed)+.5|0,i.g[o]=255*Math.pow(o/255,1/t.gammaGreen)+.5|0,i.b[o]=255*Math.pow(o/255,1/t.gammaBlue)+.5|0;return{table:i}}},{key:"callback",value:function(t,e,r,n,o,i){return{r:this.data.table.r[t.r],g:this.data.table.g[t.g],b:this.data.table.b[t.b],a:t.a}}}])&&Xt(e.prototype,r),n&&Xt(e,n),u}(j);function Ht(t,e,r){return{r:e.r+t*(r.r-e.r),g:e.g+t*(r.g-e.g),b:e.b+t*(r.b-e.b),a:e.a+t*(r.a-e.a)}}function zt(t,e,r){var n=function(t,e,r){var n=t/255,o=e/255,i=r/255;return n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,o>.04045?o=Math.pow((o+.055)/1.055,2.4):o/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:.4124*(n*=100)+.3576*(o*=100)+.1805*(i*=100),y:.2126*n+.7152*o+.0722*i,z:.0193*n+.1192*o+.9505*i}}(t,e,r),o=n.x/95.047,i=n.y/100,a=n.z/108.883;return o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,{l:116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,a:500*(o-i),b:200*(i-(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116))}}function Wt(t){return(Wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ut(t,e){return(Ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Jt(t,e){if(e&&("object"===Wt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Kt(t){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ut(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Kt(o);if(i){var r=Kt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Jt(this,t)});function u(){return Ft(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"hsb-adjust"}}],(r=[{key:"getDefaultParameters",value:function(){return{h:1,s:1,b:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=function(t,e,r){var n,o,i=Math.max(t,e,r),a=Math.min(t,e,r);if(0==(o=0!==i?(i-a)/i:0))n=0;else{var u=(i-t)/(i-a),c=(i-e)/(i-a),f=(i-r)/(i-a);n=t===i?f-c:e===i?2+u-f:4+c-u,(n/=6)<0&&(n+=1)}return{h:n,s:o,b:i/255}}(t.r,t.g,t.b);for(a.h+=n.h;a.h<0;)a.h+=2*Math.PI;a.s+=n.s,a.s=Math.max(Math.min(a.s,1),0),a.b+=n.b,a.b=Math.max(Math.min(a.b,1),0);var u=function(t,e,r){var n,o,i;if(0===e)n=255*r+.5,o=255*r+.5,i=255*r+.5;else{var a=6*(t-Math.floor(t)),u=a-Math.floor(a),c=r*(1-e),f=r*(1-e*u),l=r*(1-e*(1-u));switch(0|a){case 0:n=255*r+.5,o=255*l+.5,i=255*c+.5;break;case 1:n=255*f+.5,o=255*r+.5,i=255*c+.5;break;case 2:n=255*c+.5,o=255*r+.5,i=255*l+.5;break;case 3:n=255*c+.5,o=255*f+.5,i=255*r+.5;break;case 4:n=255*l+.5,o=255*c+.5,i=255*r+.5;break;case 5:n=255*r+.5,o=255*c+.5,i=255*f+.5;break;default:n=0,o=0,i=0}}return{r:parseInt(n),g:parseInt(o),b:parseInt(i)}}(a.h,a.s,a.b);return t.r=u.r,t.g=u.g,t.b=u.b,t}}])&&Vt(e.prototype,r),n&&Vt(e,n),u}(j);function Zt(t){return(Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function te(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ee(t,e){return(ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function re(t,e){if(e&&("object"===Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ne(t){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const oe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ee(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ne(o);if(i){var r=ne(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return re(this,t)});function u(){return $t(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"invert-alpha"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return t.a=255-t.a,t}}])&&te(e.prototype,r),n&&te(e,n),u}(j);function ie(t){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ce(t,e){return(ce=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function fe(t,e){if(e&&("object"===ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const se=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ce(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=le(o);if(i){var r=le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fe(this,t)});function u(){return ae(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"invert"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t}}])&&ue(e.prototype,r),n&&ue(e,n),u}(j);function ye(t){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function he(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function be(t,e){return(be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function de(t,e){if(e&&("object"===ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ve(t)}function ve(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function me(t){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ge(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const we=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&be(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=me(o);if(i){var r=me(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return de(this,t)});function u(){var t;pe(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ge(ve(t=a.call.apply(a,[this].concat(r))),"data",{lut:[]}),t}return e=u,n=[{key:"getName",value:function(){return"levels"}}],(r=[{key:"getDefaultParameters",value:function(){return{low:0,high:1,lowOutput:0,highOutput:1}}},{key:"before",value:function(t,e,r,n){var o,i,a=new function(t,e,r,n,o){var i,a,u,c,f,l=new Array(3),s=new Array(4),y=new Array(4),p=new Array(3),h=new Array(3),b=new Array(3),d=e*r,v=!0;for(i=0;i<l.length;i+=1)for(l[i]=new Array(256),a=0;a<256;a+=1)l[i][a]=0;for(f=0;f<r;f+=1)for(c=0;c<e;c+=1)u=f*e*4+4*c,l[0][t.data[u]]++,l[1][t.data[u+1]]++,l[2][t.data[u+2]]++;for(i=0;i<256;i+=1)if(l[0][i]!==l[1][i]||l[1][i]!==l[2][i]){v=!1;break}for(i=0;i<3;i+=1){for(a=0;a<256;a+=1)if(l[i][a]>0){s[i]=a;break}for(a=255;a>=0;a-=1)if(l[i][a]>0){y[i]=a;break}for(p[i]=1/0,h[i]=0,a=0;a<256;a+=1)p[i]=Math.min(p[i],l[i][a]),h[i]=Math.max(h[i],l[i][a]),b[i]+=a*l[i][a];b[i]/=d,s[3]=Math.min(s[0],s[1],s[2]),y[3]=Math.max(y[0],y[1],y[2])}this.getNumSamples=function(){return d},this.isGray=function(){return v},this.getFrequency=function(t,e){return e?d<1||t<0||t>2||e<0||e>255?-1:l[t][e]:d>0&&v&&e>=0&&e<=255?l[0][e]:-1},this.getMinFrequency=function(t){return t?d<1||t<0||t>2?-1:p[t]:d>0&&v?p[0]:-1},this.getMaxFrequency=function(t){return t?d<1||t<0||t>2?-1:h[t]:d>0&&v?h[0]:-1},this.getMinValue=function(t){return t?s[t]:d>0&&v?s[0]:-1},this.getMaxValue=function(t){return t?y[t]:d>0&&v?y[0]:-1},this.getMeanValue=function(t){return t?b[t]:d>0&&v?b[0]:-1}}(n,e,r,0,e),u=new Array(3),c=255*t.low,f=255*t.high;for(o=0;o<u.length;o+=1)u[o]=new Array(256);for(c===f&&f++,o=0;o<3;o+=1)for(i=0;i<256;i+=1)u[o][i]=255*(t.lowOutput+(t.highOutput-t.lowOutput)*(i-c)/(f-c));return a.isGray(),{lut:u}}},{key:"callback",value:function(t,e,r,n,o,i){return{r:this.data.lut[0][t.r],g:this.data.lut[1][t.g],b:this.data.lut[2][t.b],a:t.a}}}])&&he(e.prototype,r),n&&he(e,n),u}(j);function Oe(t){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function je(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _e(t,e){return(_e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ke(t,e){if(e&&("object"===Oe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Se(t){return(Se=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Re=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_e(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Se(o);if(i){var r=Se(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ke(this,t)});function u(){return Pe(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"rescale"}}],(r=[{key:"getDefaultParameters",value:function(){return{scale:1}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=n.scale*t.r,t.g=n.scale*t.g,t.b=n.scale*t.b,t}}])&&je(e.prototype,r),n&&je(e,n),u}(j);function xe(t){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Be(t,e){return(Be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function De(t,e){if(e&&("object"===xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Te(t){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Ce=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Be(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Te(o);if(i){var r=Te(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return De(this,t)});function u(){return Me(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"solarize"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return{r:255*(t.r/255>.5?2*(t.r/255-.5):2*(.5-t.r/255)),g:255*(t.g/255>.5?2*(t.g/255-.5):2*(.5-t.g/255)),b:255*(t.b/255>.5?2*(t.b/255-.5):2*(.5-t.b/255)),a:t.a}}}])&&Ee(e.prototype,r),n&&Ee(e,n),u}(j);function Ie(t){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ae(t,e){return(Ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ne(t,e){if(e&&("object"===Ie(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ge(t){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Le=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ae(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ge(o);if(i){var r=Ge(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ne(this,t)});function u(){return Xe(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"threshold"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return(t.r+t.g+t.b)/3>=127?{r:255,g:255,b:255,a:t.a}:{r:0,g:0,b:0,a:t.a}}}])&&Ye(e.prototype,r),n&&Ye(e,n),u}(j);function qe(t){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function He(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function We(t,e){return(We=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Fe(t,e){if(e&&("object"===qe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ve(t)}function Ve(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ue(t){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Je(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ke=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&We(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ue(o);if(i){var r=Ue(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Fe(this,t)});function u(){var t;He(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Je(Ve(t=a.call.apply(a,[this].concat(r))),"data",{lut:[]}),t}return e=u,n=[{key:"getName",value:function(){return"tritone"}}],(r=[{key:"getDefaultParameters",value:function(){return{shadowColor:{r:0,g:0,b:0,a:255},midColor:{r:136,g:136,b:136,a:255},highColor:{r:255,g:255,b:255,a:255}}}},{key:"before",value:function(t){var e,r,n=[];for(e=0;e<128;e+=1)r=e/127,n[e]=Ht(r,t.shadowColor,t.midColor);for(e=128;e<256;e+=1)r=(e-127)/128,n[e]=Ht(r,t.midColor,t.highColor);return{lut:n}}},{key:"callback",value:function(t,e,r,n,o,i){var a=Math.floor((t.r+t.g+t.b)/3);return this.data.lut[a]}}])&&ze(e.prototype,r),n&&ze(e,n),u}(j);function Qe(t){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ze(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tr(t,e){return(tr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function er(t,e){if(e&&("object"===Qe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return rr(t)}function rr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function nr(t){return(nr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function or(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const ir=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=nr(o);if(i){var r=nr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return er(this,t)});function u(){var t;Ze(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return or(rr(t=a.call.apply(a,[this].concat(r))),"data",{minDensity:0,maxDensity:0}),t}return e=u,n=[{key:"getName",value:function(){return"dissolve"}}],(r=[{key:"getDefaultParameters",value:function(){return{density:1,softness:0}}},{key:"before",value:function(t,e,r,n){var o=(1-t.density)*(1+t.softness);return{minDensity:o-t.softness,maxDensity:o}}},{key:"callback",value:function(t,e,r,n,o,i){var a=Math.random(),u=function(t,e,r){return r<t?0:r>=e?1:(r=(r-t)/(e-t))*r*(3-2*r)}(this.data.minDensity,this.data.maxDensity,a);return t.a=t.a*u,t}}])&&$e(e.prototype,r),n&&$e(e,n),u}(j);function ar(t){return(ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ur(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fr(t,e){return(fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function lr(t,e){if(e&&("object"===ar(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return sr(t)}function sr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yr(t){return(yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const hr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yr(o);if(i){var r=yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return lr(this,t)});function u(){var t;ur(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return pr(sr(t=a.call.apply(a,[this].concat(r))),"data",{hEdgeMatrix:[],vEdgeMatrix:[]}),t}return e=u,n=[{key:"getName",value:function(){return"edge"}}],(r=[{key:"getDefaultParameters",value:function(){return{matrixes:{robertsV:[0,0,-1,0,1,0,0,0,0],robertsH:[-1,0,0,0,1,0,0,0,0],prewittV:[-1,0,1,-1,0,1,-1,0,1],prewittH:[-1,-1,-1,0,0,0,1,1,1],sobelV:[-1,0,1,-2,0,2,-1,0,1],sobelH:[-1,-2,-1,0,0,0,1,2,1],freiChenV:[-1,0,1,-Math.sqrt(2),0,Math.sqrt(2),-1,0,1],freiChenH:[-1,-Math.sqrt(2),-1,0,0,0,1,Math.sqrt(2),1]},hEdgeMatrix:"sobelV",vEdgeMatrix:"sobelH"}}},{key:"before",value:function(t,e,r,n){var o,i,a=t.hEdgeMatrix,u=t.vEdgeMatrix;return"string"==typeof a&&(o=t.matrixes[t.hEdgeMatrix]),"string"==typeof u&&(i=t.matrixes[t.vEdgeMatrix]),{hEdgeMatrix:o,vEdgeMatrix:i}}},{key:"callback",value:function(t,e,r,n,o,i){var a,u,c,f,l,s,y,p,h=0,b=0,d=0,v=0,m=0,g=0,w=0,O=0,P=0;for(a=-1;a<=1;a+=1)for(0<=(u=r+a)&&u<i||(u=r),l=3*(a+1)+1,c=-1;c<=1;c+=1)0<=(f=e+c)&&f<o||(f=e),s=this.getOriginalPixel(f,u),y=this.data.hEdgeMatrix[l+c],p=this.data.vEdgeMatrix[l+c],h=s.r,b=s.g,d=s.b,v+=Math.floor(y*h),m+=Math.floor(y*b),g+=Math.floor(y*d),w+=Math.floor(p*h),O+=Math.floor(p*b),P+=Math.floor(p+d);return{r:h=Math.floor(Math.sqrt(v*v+w*w)/1.8),g:b=Math.floor(Math.sqrt(m*m+O*O)/1.8),b:d=Math.floor(Math.sqrt(g*g+P*P)/1.8),a:t.a}}}])&&cr(e.prototype,r),n&&cr(e,n),u}(j);function br(t){return(br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function mr(t,e){return(mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gr(t,e){if(e&&("object"===br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wr(t){return(wr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wr(o);if(i){var r=wr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return gr(this,t)});function u(){return dr(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"channel-mix"}}],(r=[{key:"getDefaultParameters",value:function(){return{blueGreen:1,redBlue:1,greenRed:1,intoR:1,intoG:1,intoB:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=t.r,u=t.g,c=t.b;return{r:(n.intoR*(n.blueGreen*u+(255-n.blueGreen)*c)/255+(255-n.intoR)*a)/255,g:(n.intoG*(n.redBlue*u+(255-n.redBlue)*a)/255+(255-n.intoG)*u)/255,b:(n.intoB*(n.greenRed*u+(255-n.greenRed)*u)/255+(255-n.intoB)*c)/255,a:t.a}}}])&&vr(e.prototype,r),n&&vr(e,n),u}(j);function Pr(t){return(Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kr(t,e){return(kr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Sr(t,e){if(e&&("object"===Pr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Rr(t)}function Rr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xr(t){return(xr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Er=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xr(o);if(i){var r=xr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Sr(this,t)});function u(){var t;jr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Mr(Rr(t=a.call.apply(a,[this].concat(r))),"data",{remap:function(t){return 0},min:0,max:0}),t}return e=u,n=[{key:"getName",value:function(){return"auto-contrast"}}],(r=[{key:"before",value:function(t,e,r){var n,o,i,a=1/0,u=-1;for(o=0;o<r;o+=1)for(n=0;n<e;n+=1)i=this.getPixel(n,o),a=Math.min((i.r+i.g+i.b)/3,a),u=Math.max((i.r+i.g+i.b)/3,u);return{min:a,max:u,remap:function(t){return 255*(t-a)/(u-a)}}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=this.data.remap(t.r),t.g=this.data.remap(t.g),t.b=this.data.remap(t.b),t}}])&&_r(e.prototype,r),n&&_r(e,n),u}(j);function Br(t){return(Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Tr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Dr(Object(r),!0).forEach((function(e){Cr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Dr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Cr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ir(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xr(t,e){return(Xr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Yr(t,e){if(e&&("object"===Br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ar(t){return(Ar=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Nr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xr(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ar(r);if(n){var o=Ar(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return Yr(this,t)});function i(){return Ir(this,i),o.apply(this,arguments)}return(e=[{key:"callback",value:function(t,e,r,n,o){throw"Extend it."}},{key:"run",value:function(t,e){var r,n;e=Tr(Tr({},this.getDefaultParameters()),e);var o=function(t){return 0|Math.min(Math.max(t,0),255)},i={data:null},a=new Uint8ClampedArray(t.data);for(i.data=this.before.call(i,e,t.width,t.height,t),n=0;n<t.height;n+=1)for(r=0;r<t.width;r+=1){var u=this.callback.call(i,r,n,e,t.width,t.height),c=o(u[0]),f=o(u[1]),l=n*t.width*4+4*r,s=f*t.width*4+4*c;a[l+0]=t.data[s+0],a[l+1]=t.data[s+1],a[l+2]=t.data[s+2],a[l+3]=t.data[s+3]}return t.data.set(a),t}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(i.prototype,e),i}(h);function Gr(t){return(Gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Hr(t,e){return(Hr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zr(t,e){if(e&&("object"===Gr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Wr(t)}function Wr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fr(t){return(Fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ur=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Hr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fr(o);if(i){var r=Fr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return zr(this,t)});function u(){var t;Lr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Vr(Wr(t=a.call.apply(a,[this].concat(r))),"data",{sinTable:[],cosTable:[]}),t}return e=u,n=[{key:"getName",value:function(){return"diffuse"}}],(r=[{key:"getDefaultParameters",value:function(){return{scale:4}}},{key:"before",value:function(t,e,r,n){var o,i,a=new Array(256),u=new Array(256);for(o=0;o<256;o+=1)i=2*Math.PI*o/256,a[o]=t.scale*Math.sin(i),u[o]=t.scale*Math.cos(i);return{sinTable:a,cosTable:u}}},{key:"callback",value:function(t,e,r,n,o){var i=255*Math.random()|0,a=Math.random();return[t+a*this.data.sinTable[i],e+a*this.data.cosTable[i]]}}])&&qr(e.prototype,r),n&&qr(e,n),u}(Nr);function Jr(t){return(Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zr(t,e){return(Zr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $r(t,e){if(e&&("object"===Jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tn(t)}function tn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function en(t){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const nn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zr(t,e)}(c,t);var e,r,n,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=en(o);if(i){var r=en(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $r(this,t)});function c(){var t;Kr(this,c);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return rn(tn(t=u.call.apply(u,[this].concat(r))),"data",{icentreX:0,icentreY:0}),t}return e=c,n=[{key:"getName",value:function(){return"kaleidoscope"}}],(r=[{key:"getDefaultParameters",value:function(){return{centreX:.5,centreY:.5,angle:0,angle2:0,sides:3,radius:0}}},{key:"before",value:function(t,e,r,n){return{icentreX:e*t.centreX,icentreY:r*t.centreY}}},{key:"callback",value:function(t,e,r,n,o){var i=t-this.data.icentreX,u=e-this.data.icentreY,c=Math.sqrt(i*i+u*u),f=Math.atan2(u,i)-r.angle-r.angle2;if(f=a(f/Math.PI*r.sides*.5),0!==r.radius){var l=Math.cos(f),s=r.radius/l;c=s*a(c/s)}return f+=r.angle,[this.data.icentreX+c*Math.cos(f),this.data.icentreY+c*Math.sin(f)]}}])&&Qr(e.prototype,r),n&&Qr(e,n),c}(Nr);var on={},an=!1;const un={init:function(){if(an)return!1;an=!0,on.B=256,on.BM=255,on.N=4096,on.P=new Array(on.B+on.B+2),on.G1=new Array(on.B+on.B+2),on.G2=new Array(on.B+on.B+2);for(var t=0;t<on.G2.length;t+=1)on.G2[t]=new Array(2);on.G3=new Array(on.B+on.B+2);for(var e=0;e<on.G3.length;e+=1)on.G3[e]=new Array(3);var r,n,o;for(r=0;r<on.B;r+=1){for(on.P[r]=r,on.G1[r]=(this.random()%(on.B+on.B)-on.B)/on.B,on.G2[r]=[],n=0;n<2;n+=1)on.G2[r][n]=(this.random()%(on.B+on.B)-on.B)/on.B;for(on.G2[r]=this.normalize2(on.G2[r]),on.G3[r]=[],n=0;n<3;n+=1)on.G3[r][n]=(this.random()%(on.B+on.B)-on.B)/on.B;on.G3[r]=this.normalize3(on.G3[r])}for(r=on.B-1;r>=0;r-=1)o=on.P[r],on.P[r]=on.P[n=this.random()%on.B],on.P[n]=o;for(r=0;r<on.B+2;r+=1){for(on.P[on.B+r]=on.P[r],on.G1[on.B+r]=on.G1[r],n=0;n<2;n+=1)on.G2[on.B+r][n]=on.G2[r][n];for(n=0;n<3;n++)on.G3[on.B+r][n]=on.G3[r][n]}},random:function(){return 2147483647&(256*Math.random()*256|0)},normalize2:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return t[0]=t[0]/e,t[1]=t[1]/e,t[2]=t[2]/e,t},normalize3:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return t[0]=t[0]/e,t[1]=t[1]/e,t},sCurve:function(t){return t*t*(3-2*t)},lerp:function(t,e,r){return e+t*(r-e)},noise1:function(t){var e,r,n,o,i,a,u,c;return this.init(),a=t+on.N,r=1+(e=parseInt(a)&on.BM)&on.BM,o=(n=a-parseInt(a))-1,i=this.sCurve(n),u=n*on.G1[on.P[e]],c=o*on.G1[on.P[r]],2.3*this.lerp(i,u,c)},noise2:function(t,e){var r,n,o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j=[];return this.init(),m=t+on.N,n=1+(r=parseInt(m)&on.BM)&on.BM,s=(l=m-parseInt(m))-1,m=e+on.N,i=1+(o=parseInt(m)&on.BM)&on.BM,p=(y=m-parseInt(m))-1,O=on.P[r],P=on.P[n],a=on.P[O+o],u=on.P[P+o],c=on.P[O+i],f=on.P[P+i],h=this.sCurve(l),b=this.sCurve(y),g=l*(j=on.G2[a])[0]+y*j[1],w=s*(j=on.G2[u])[0]+y*j[1],d=this.lerp(h,g,w),g=l*(j=on.G2[c])[0]+p*j[1],w=s*(j=on.G2[f])[0]+p*j[1],v=this.lerp(h,g,w),1.5*this.lerp(b,d,v)},noise3:function(t,e,r){var n,o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j,_,k,S,R,x,M,E;return this.init(),S=t+on.N,o=1+(n=parseInt(S)&on.BM)&on.BM,h=(p=S-parseInt(S))-1,S=e+on.N,a=1+(i=parseInt(S)&on.BM)&on.BM,d=(b=S-parseInt(S))-1,S=r+on.N,c=1+(u=parseInt(S)&on.BM)&on.BM,m=(v=S-parseInt(S))-1,M=on.P[n],E=on.P[o],f=on.P[M+i],l=on.P[E+i],s=on.P[M+a],y=on.P[E+a],S=this.sCurve(p),w=this.sCurve(b),O=this.sCurve(v),R=p*(g=on.G3[f+u])[0]+b*g[1]+v*g[2],x=h*(g=on.G3[l+u])[0]+b*g[1]+v*g[2],P=this.lerp(S,R,x),R=p*(g=on.G3[s+u])[0]+d*g[1]+v*g[2],x=h*(g=on.G3[y+u])[0]+d*g[1]+v*g[2],j=this.lerp(S,R,x),_=this.lerp(w,P,j),R=p*(g=on.G3[f+c])[0]+b*g[1]+m*g[2],x=h*(g=on.G3[l+c])[0]+b*g[1]+m*g[2],P=this.lerp(S,R,x),R=p*(g=on.G3[s+c])[0]+d*g[1]+m*g[2],x=h*(g=on.G3[y+c])[0]+d*g[1]+m*g[2],j=this.lerp(S,R,x),k=this.lerp(w,P,j),1.5*this.lerp(O,_,k)},turbulence3:function(t,e,r,n){var o,i=0;for(o=1;o<=n;o*=2)i+=Math.abs(this.noise3(o*t,o*e,o*r))/o;return i}};function cn(t){return(cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ln(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function sn(t,e){return(sn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yn(t,e){if(e&&("object"===cn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return pn(t)}function pn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hn(t){return(hn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const dn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&sn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hn(o);if(i){var r=hn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return yn(this,t)});function u(){var t;fn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return bn(pn(t=a.call.apply(a,[this].concat(r))),"data",{sinTable:[],cosTable:[],displacementMap:function(t,e){return 0}}),t}return e=u,n=[{key:"getName",value:function(){return"marble"}}],(r=[{key:"getDefaultParameters",value:function(){return{xScale:4,yScale:4,amount:1,turbulence:1}}},{key:"before",value:function(t,e,r,n){for(var o,i=new Array(256),a=new Array(256),u=0;u<256;u+=1)o=2*Math.PI*u/256*t.turbulence,i[u]=-t.yScale*Math.sin(o),a[u]=t.yScale*Math.cos(o);return{sinTable:i,cosTable:a,displacementMap:function(e,r){var n=127*(1+un.noise2(e/t.xScale,r/t.yScale));return Math.min(255,Math.max(0,n))}}}},{key:"callback",value:function(t,e,r,n,o){var i=Math.floor(this.data.displacementMap(t,e));return[t+this.data.sinTable[i],e+this.data.cosTable[i]]}}])&&ln(e.prototype,r),n&&ln(e,n),u}(Nr);function vn(t){return(vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wn(t,e){return(wn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function On(t,e){if(e&&("object"===vn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Pn(t)}function Pn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jn(t){return(jn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const kn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jn(o);if(i){var r=jn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return On(this,t)});function u(){var t;mn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return _n(Pn(t=a.call.apply(a,[this].concat(r))),"data",{icentreX:0,icentreY:0,radius2:0,radius:0}),t}return e=u,n=[{key:"getName",value:function(){return"pinch"}}],(r=[{key:"getDefaultParameters",value:function(){return{angle:0,centreX:.5,centreY:.5,radius:100,amount:.5}}},{key:"before",value:function(t,e,r,n){var o=e*t.centreX,i=r*t.centreY,a=t.radius;return 0===a&&(a=Math.min(o,i)),{icentreX:o,icentreY:i,radius:a,radius2:a*a}}},{key:"callback",value:function(t,e,r,n,o){var i,a,u,c,f,l,s=t-this.data.icentreX,y=e-this.data.icentreY,p=s*s+y*y;return p>this.data.radius2||0===p?[t,e]:(i=Math.sqrt(p/this.data.radius2),s*=a=Math.pow(Math.sin(.5*Math.PI*i),-r.amount),y*=a,u=1-i,c=r.angle*u*u,f=Math.sin(c),l=Math.cos(c),[this.data.icentreX+l*s-f*y,this.data.icentreY+f*s+l*y])}}])&&gn(e.prototype,r),n&&gn(e,n),u}(Nr);function Sn(t){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mn(t,e){return(Mn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function En(t,e){if(e&&("object"===Sn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bn(t){return(Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Dn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mn(t,e)}(f,t);var e,r,o,i,u,c=(i=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bn(i);if(u){var r=Bn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return En(this,t)});function f(){return Rn(this,f),c.apply(this,arguments)}return e=f,o=[{key:"getName",value:function(){return"ripple"}}],(r=[{key:"getDefaultParameters",value:function(){return{xAmplitude:5,yAmplitute:0,xWaveLength:16,yWaveLength:16,waveType:"SINE"}}},{key:"callback",value:function(t,e,r,o,i){var u,c,f=e/r.xWaveLength,l=t/r.yWaveLength;switch(r.waveType){case"SINE":default:u=Math.sin(f),c=Math.sin(l);break;case"SAWTOOTH":u=n(f,1),c=n(l,1);break;case"TRIANGLE":u=a(f),c=a(l);break;case"NOISE":u=un.noise1(f),c=un.noise1(l)}return[t+r.xAmplitude*u,e+r.yAmplitute*c]}}])&&xn(e.prototype,r),o&&xn(e,o),f}(Nr);function Tn(t){return(Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function In(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xn(t,e){return(Xn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Yn(t,e){if(e&&("object"===Tn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return An(t)}function An(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nn(t){return(Nn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ln=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Nn(o);if(i){var r=Nn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Yn(this,t)});function u(){var t;Cn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Gn(An(t=a.call.apply(a,[this].concat(r))),"data",{shx:0,shy:0}),t}return e=u,n=[{key:"getName",value:function(){return"shear"}}],(r=[{key:"getDefaultParameters",value:function(){return{xAngle:0,yAngle:0,xOffset:0,yOffset:0}}},{key:"before",value:function(t,e,r){return{shx:Math.sin(t.xAngle),shy:Math.sin(t.yAngle)}}},{key:"callback",value:function(t,e,r,n,o){return[t+r.xOffset+e*this.data.shx,e+r.yOffset+t*this.data.shy]}}])&&In(e.prototype,r),n&&In(e,n),u}(Nr);function qn(t){return(qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Wn(t,e){return(Wn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Fn(t,e){if(e&&("object"===qn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Vn(t)}function Vn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Un(t){return(Un=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Kn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Un(o);if(i){var r=Un(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Fn(this,t)});function u(){var t;Hn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Jn(Vn(t=a.call.apply(a,[this].concat(r))),"data",{icentreX:0,icentreY:0,a2:0,b2:0,a:0,b:0}),t}return e=u,n=[{key:"getName",value:function(){return"sphere"}}],(r=[{key:"getDefaultParameters",value:function(){return{a:0,b:0,centreX:.5,centreY:.5,refractionIndex:1.5}}},{key:"before",value:function(t,e,r){var n=e*t.centreX,o=r*t.centreY,i=t.a,a=t.b;return 0===i&&(i=e/2),0===a&&(a=r/2),{icentreX:n,icentreY:o,a:i,b:a,a2:i*i,b2:a*a}}},{key:"callback",value:function(t,e,r,n,o){var i=t-this.data.icentreX,a=e-this.data.icentreY,u=i*i,c=a*a,f=1/r.refractionIndex,l=Math.sqrt((1-u/this.data.a2-c/this.data.b2)*(this.data.a*this.data.b)),s=l*l,y=Math.acos(i/Math.sqrt(u+s)),p=Math.PI/2-y,h=Math.asin(Math.sin(p)*f),b=Math.acos(a/Math.sqrt(c+s)),d=new Array(2);return c>=this.data.b2-this.data.b2/u/this.data.a2?[t,e]:(h=Math.PI/2-y-h,d[0]=t-Math.tan(h)*l,p=Math.PI/2-b,h=Math.asin(Math.sin(p)*f),h=Math.PI/2-b-h,d[1]=e-Math.tan(h)*l,d)}}])&&zn(e.prototype,r),n&&zn(e,n),u}(Nr);function Qn(t){return(Qn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function to(t,e){return(to=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function eo(t,e){if(e&&("object"===Qn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ro(t)}function ro(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function no(t){return(no=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function oo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const io=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&to(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=no(o);if(i){var r=no(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return eo(this,t)});function u(){var t;Zn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return oo(ro(t=a.call.apply(a,[this].concat(r))),"data",{m00:0,m01:0,m10:0,m11:0}),t}return e=u,n=[{key:"getName",value:function(){return"swim"}}],(r=[{key:"getDefaultParameters",value:function(){return{scale:32,turbulence:0,amount:1,time:0,angle:0,stretch:1}}},{key:"before",value:function(t,e,r){var n=Math.cos(t.angle),o=Math.sin(t.angle);return{m00:n,m01:o,m10:-o,m11:n}}},{key:"callback",value:function(t,e,r,n,o){var i=this.data.m00*t+this.data.m01*e,a=this.data.m10*t+this.data.m11*e;return i/=r.scale,a/=r.scale*r.stretch,1===r.turbulence?[t+r.amount*un.noise3(i+.5,a,r.time),e+r.amount*un.noise3(i,a+.5,r.time)]:[t+r.amount*un.turbulence3(i+.5,a,r.turbulence,r.time),e+r.amount*un.turbulence3(i,a+.5,r.turbulence,r.time)]}}])&&$n(e.prototype,r),n&&$n(e,n),u}(Nr);function ao(t){return(ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function co(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fo(t,e){return(fo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function lo(t,e){if(e&&("object"===ao(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return so(t)}function so(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yo(t){return(yo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function po(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const ho=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fo(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yo(o);if(i){var r=yo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return lo(this,t)});function u(){var t;uo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return po(so(t=a.call.apply(a,[this].concat(r))),"data",{iCentreX:0,iCentreY:0,radius:0,radius2:0}),t}return e=u,n=[{key:"getName",value:function(){return"twirl"}}],(r=[{key:"getDefaultParameters",value:function(){return{angle:0,centreX:.5,centreY:.5,radius:100,radius2:100}}},{key:"before",value:function(t,e,r){var n=e*t.centreX,o=r*t.centreY,i=t.radius;return 0===i&&(i=Math.min(n,o)),{iCentreX:n,iCentreY:o,radius:i,radius2:i*i}}},{key:"callback",value:function(t,e,r,n,o){var i,a=t-this.data.iCentreX,u=e-this.data.iCentreY,c=a*a+u*u;return c>r.radius2?[t,e]:(c=Math.sqrt(c),i=Math.atan2(u,a)+r.angle*(r.radius-c)/r.radius,[this.data.iCentreX+c*Math.cos(i),this.data.iCentreY+c*Math.sin(i)])}}])&&co(e.prototype,r),n&&co(e,n),u}(Nr);function bo(t){return(bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function go(t,e){return(go=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wo(t,e){if(e&&("object"===bo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Oo(t)}function Oo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Po(t){return(Po=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const _o=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&go(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Po(o);if(i){var r=Po(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return wo(this,t)});function u(){var t;vo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return jo(Oo(t=a.call.apply(a,[this].concat(r))),"data",{iCentreX:0,iCentreY:0,radius2:0,radius:0}),t}return e=u,n=[{key:"getName",value:function(){return"water"}}],(r=[{key:"getDefaultParameters",value:function(){return{waveLength:16,amplitude:10,phase:0,centreX:.5,centreY:.5,radius:50}}},{key:"before",value:function(t,e,r){var n=e*t.centreX,o=r*t.centreY,i=t.radius;return 0===i&&(i=Math.min(n,o)),{iCentreX:n,iCentreY:o,radius:i,radius2:i*i}}},{key:"callback",value:function(t,e,r,n,o){var i,a,u=t-this.data.iCentreX,c=e-this.data.iCentreY,f=u*u+c*c;return f>this.data.radius2?[t,e]:(i=Math.sqrt(f),a=r.amplitude*Math.sin(i/r.waveLength*Math.PI*2-r.phase),a*=(r.radius-i)/r.radius,0!==i&&(a*=r.waveLength/i),[t+u*a,e+c*a])}}])&&mo(e.prototype,r),n&&mo(e,n),u}(Nr);function ko(t){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function So(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ro(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xo(t,e){return(xo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Mo(t,e){if(e&&("object"===ko(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Eo(t)}function Eo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bo(t){return(Bo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Do(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const To=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xo(t,e)}(c,t);var e,r,o,i,a,u=(i=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bo(i);if(a){var r=Bo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Mo(this,t)});function c(){var t;So(this,c);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Do(Eo(t=u.call.apply(u,[this].concat(r))),"data",{icentreX:0,icentreY:0,width:0}),t}return e=c,o=[{key:"getName",value:function(){return"circle"}}],(r=[{key:"getDefaultParameters",value:function(){return{radius:10,height:20,angle:0,spreadAngle:Math.PI,centreX:.5,centreY:.5}}},{key:"before",value:function(t,e,r,n){return{icentreX:e*t.centreX,icentreY:r*t.centreY,width:--e}}},{key:"callback",value:function(t,e,r,o,i){var a=t-this.data.icentreX,u=e-this.data.icentreX,c=Math.atan2(-u,-a)+r.angle,f=Math.sqrt(a*a+u*u);return c=n(c,2*Math.PI),[this.data.width*c/r.spreadAngle+1e-5,i*(1-(f-r.radius)/(i+1e-5))]}}])&&Ro(e.prototype,r),o&&Ro(e,o),c}(Nr);function Co(t){return(Co="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Io(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yo(t,e){return(Yo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ao(t,e){if(e&&("object"===Co(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return No(t)}function No(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Go(t){return(Go=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const qo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yo(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Go(o);if(i){var r=Go(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ao(this,t)});function u(){var t;Io(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Lo(No(t=a.call.apply(a,[this].concat(r))),"data",{sin:0,cos:0,icentreX:0,icentreY:0}),t}return e=u,n=[{key:"getName",value:function(){return"rotate"}}],(r=[{key:"getDefaultParameters",value:function(){return{angle:Math.PI}}},{key:"before",value:function(t,e,r,n){return{cos:Math.cos(t.angle),sin:Math.sin(t.angle),icentreX:e/2,icentreY:r/2}}},{key:"callback",value:function(t,e,r,n,o){return[this.data.cos*(t-this.data.icentreX)-this.data.sin*(e-this.data.icentreY)+this.data.icentreY,this.data.sin*(t-this.data.icentreX)-this.data.cos*(e-this.data.icentreY)+this.data.icentreY]}}])&&Xo(e.prototype,r),n&&Xo(e,n),u}(Nr);function Ho(t){return(Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Fo(t,e){return(Fo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Vo(t,e){if(e&&("object"===Ho(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Uo(t){return(Uo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Jo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fo(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Uo(o);if(i){var r=Uo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Vo(this,t)});function u(){return zo(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"offset"}}],(r=[{key:"getDefaultParameters",value:function(){return{xOffset:100,yOffset:100,wrap:!0}}},{key:"callback",value:function(t,e,r,n,o){return r.wrap?[(t+n-r.xOffset)%n,(e+o-r.yOffset)%o]:[t-r.xOffset,e-r.yOffset]}}])&&Wo(e.prototype,r),n&&Wo(e,n),u}(Nr);function Ko(t){return(Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $o(t,e){return($o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ti(t,e){if(e&&("object"===Ko(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ei(t)}function ei(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ri(t){return(ri=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ni(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const oi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$o(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ri(o);if(i){var r=ri(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ti(this,t)});function u(){var t;Qo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ni(ei(t=a.call.apply(a,[this].concat(r))),"data",{centreX:0,centreY:0,sqr:function(t){return 0},radius:0}),t}return e=u,n=[{key:"getName",value:function(){return"polar"}}],(r=[{key:"getDefaultParameters",value:function(){return{type:"RECT_TO_POLAR"}}},{key:"before",value:function(t,e,r,n){return{centreX:e/2,centreY:r/2,radius:Math.max(e/2,r/2),sqr:function(t){return t*t}}}},{key:"callback",value:function(t,e,r,n,o){var i,a,u,c,f,l,s,y,p=0;switch(r.type){case"RECT_TO_POLAR":return t>=this.data.centreX?e>this.data.centreY?(i=Math.PI-Math.atan((t-this.data.centreX)/(e-this.data.centreY)),p=Math.sqrt(this.data.sqr(t-this.data.centreX)+this.data.sqr(e-this.data.centreY))):e<this.data.centreY?(i=Math.atan((t-this.data.centreX)/(this.data.centreY-e)),p=Math.sqrt(this.data.sqr(t-this.data.centreX)+this.data.sqr(this.data.centreY-e))):(i=Math.PI/2,p=t-this.data.centreX):t<this.data.centreX&&(e<this.data.centreY?(i=2*Math.PI-Math.atan((this.data.centreX-t)/(this.data.centreY-e)),p=Math.sqrt(this.data.sqr(this.data.centreX-t)+this.data.sqr(this.data.centreY-e))):e>this.data.centreY?(i=Math.PI+Math.atan((this.data.centreX-t)/(e-this.data.centreY)),p=Math.sqrt(this.data.sqr(this.data.centreX-t)+this.data.sqr(e-this.data.centreY))):(i=1.5*Math.PI,p=this.data.centreX-t)),(t!=this.data.centreX?Math.abs((e-this.data.centreY)/(t-this.data.centreX)):0)<=o/n?t==this.data.centreX?this.data.centreY:this.data.centreX:this.data.centreY,[n-1-(n-1)/(2*Math.PI*i),o*p/this.data.radius];case"POLAR_TO_RECT":return a=(i=t/n*Math.PI*2)>=1.5*Math.PI?2*Math.PI-i:i>=Math.PI?i-Math.PI:i>=.5*Math.PI?Math.PI-i:i,(0!=(u=Math.tan(a))?1/u:0)<=o/n?0==a?this.data.centreY:this.data.centreX:this.data.centreY,c=-(p=this.data.radius*(e/o))*Math.sin(a),f=p*Math.cos(a),i>=1.5*Math.PI?[this.data.centreX-c,this.data.centreY-f]:i>=Math.PI?[this.data.centreX-c,this.data.centreY+f]:i>=.5*Math.PI?[this.data.centreX+c,this.data.centreY+f]:[this.data.centreX+c,this.data.centreY-f];case"INVERT_IN_CIRCLE":return y=(l=t-this.data.centreX)*l+(s=e-this.data.centreY)*s,[this.data.centreX+this.data.centreX*this.data.centreX*l/y,this.data.centreY+this.data.centreY*this.data.centreY*s/y]}}}])&&Zo(e.prototype,r),n&&Zo(e,n),u}(Nr);function ii(t){return(ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ai(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ui(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ci(t,e){return(ci=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function fi(t,e){if(e&&("object"===ii(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return li(t)}function li(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function si(t){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const pi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ci(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=si(o);if(i){var r=si(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fi(this,t)});function u(){var t;ai(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return yi(li(t=a.call.apply(a,[this].concat(r))),"data",{A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0}),t}return e=u,n=[{key:"getName",value:function(){return"perspective"}}],(r=[{key:"getDefaultParameters",value:function(){return{x0:0,y0:0,x1:1,y1:0,x2:1,y2:1,x3:0,y3:1}}},{key:"before",value:function(t,e,r,n){var o=function(){var n={a11:0,a21:0,a31:0,a12:0,a22:0,a32:0,a13:0,a23:0,a33:0,A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0},o=Math.floor(e*t.x0),i=Math.floor(r*t.y0),a=Math.floor(e*t.x1),u=Math.floor(r*t.y1),c=Math.floor(e*t.x2),f=Math.floor(r*t.y2),l=Math.floor(e*t.x3),s=Math.floor(r*t.y3),y=a-c,p=u-f,h=l-c,b=s-f,d=o-a+c-l,v=i-u+f-s;return 0==d&&0==v?(n.a11=a-o,n.a21=c-a,n.a31=o,n.a12=u-i,n.a22=f-u,n.a32=i,n.a13=n.a23=0):(n.a13=(d*b-h*v)/(y*b-p*h),n.a23=(y*v-p*d)/(y*b-p*h),n.a11=a-o+n.a13*a,n.a21=l-o+n.a23*l,n.a31=o,n.a12=u-i+n.a13*u,n.a22=s-i+n.a23*s,n.a32=i),n.a33=1,n}();return o.A=o.a22*o.a33-o.a32*o.a23,o.B=o.a31*o.a23-o.a21*o.a33,o.C=o.a21*o.a32-o.a31*o.a22,o.D=o.a32*o.a13-o.a12*o.a33,o.E=o.a11*o.a33-o.a31*o.a13,o.F=o.a31*o.a12-o.a11*o.a32,o.G=o.a12*o.a23-o.a22*o.a13,o.H=o.a21*o.a13-o.a11*o.a23,o.I=o.a11*o.a22-o.a21*o.a12,o}},{key:"callback",value:function(t,e,r,n,o){return[n*(this.data.A*t+this.data.B*e+this.data.C)/(this.data.G*t+this.data.H*e+this.data.I),o*(this.data.D*t+this.data.E*e+this.data.F)/(this.data.G*t+this.data.H*e+this.data.I)]}}])&&ui(e.prototype,r),n&&ui(e,n),u}(Nr);function hi(t){return(hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function di(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bi(Object(r),!0).forEach((function(e){vi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function vi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gi(t,e){return(gi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wi(t,e){if(e&&("object"===hi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Oi(t){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Pi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gi(t,e)}(i,t);var e,r,n,o=(r=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Oi(r);if(n){var o=Oi(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return wi(this,t)});function i(){return mi(this,i),o.apply(this,arguments)}return(e=[{key:"callback",value:function(t,e,r){throw"Extend it."}},{key:"run",value:function(t,e){e=di(di({},this.getDefaultParameters()),e);var r=new Uint8ClampedArray(t.data),n=function(e,r){return r*t.width*4+4*e},o=function(t){return 0|Math.min(Math.max(t,0),255)},i={getPixel:function(t,e){var o=n(t,e);return{r:r[o+0],g:r[o+1],b:r[o+2],a:r[o+3]}},getOriginalPixelByIndex:function(e){return e*=4,{r:t.data[e],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]}},getOriginalPixel:function(e,r){var o=n(e,r);return{r:t.data[o+0],g:t.data[o+1],b:t.data[o+2],a:t.data[o+3]}},setPixel:function(t,e,i){var a=n(t,e);r[a+0]=o(i.r),r[a+1]=o(i.g),r[a+2]=o(i.b),r[a+3]=o(i.a)},setPixelByIndex:function(t,e){r[0+(t*=4)]=o(e.r),r[t+1]=o(e.g),r[t+2]=o(e.b),r[t+3]=o(e.a)},data:null,width:t.width,height:t.height};return i.data=this.before.call(i,e,t.width,t.height,t),this.callback.call(i,t.width,t.height,e),t.data.set(r),t}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(i.prototype,e),i}(h);function ji(t){return(ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ki(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Si(t,e){return(Si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ri(t,e){if(e&&("object"===ji(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xi(t){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Mi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Si(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xi(o);if(i){var r=xi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ri(this,t)});function u(){return _i(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"auto-white-balance"}}],(r=[{key:"getDefaultParameters",value:function(){return{intensity:50}}},{key:"callback",value:function(t,e,r){var n,o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w=0,O=0;for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)w+=(a=zt((i=this.getPixel(n,o)).r,i.g,i.b)).a,O+=a.b;for(u=0-O/(t*e),c=(0-w/(t*e))*(r.intensity/100)*1.1,f=u*(r.intensity/100)*1.1,o=0;o<e;o+=1)for(n=0;n<t;n+=1)(a=zt((i=this.getPixel(n,o)).r,i.g,i.b)).a+=c,a.b+=f,(l=a.l,s=a.a,y=a.b,v=void 0,m=void 0,g=void 0,p=function(t,e,r){var n=(t+16)/116,o=e/500+n,i=n-r/200;return n=Math.pow(n,3)>.008856?Math.pow(n,3):(n-16/116)/7.787,{x:95.047*(o=Math.pow(o,3)>.008856?Math.pow(o,3):(o-16/116)/7.787),y:100*n,z:108.883*(i=Math.pow(i,3)>.008856?Math.pow(i,3):(i-16/116)/7.787)}}(l,s,y),h=p.x/100,b=p.y/100,d=p.z/100,v=3.2406*h+-1.5372*b+-.4986*d,m=-.9689*h+1.8758*b+.0415*d,g=.0557*h+-.204*b+1.057*d,v>.0031308?v=1.055*Math.pow(v,1/2.4)-.055:v*=12.92,m>.0031308?m=1.055*Math.pow(m,1/2.4)-.055:m*=12.92,g>.0031308?g=1.055*Math.pow(g,1/2.4)-.055:g*=12.92,i={r:255*v,g:255*m,b:255*g}).a=this.getPixel(n,o).a,this.setPixel(n,o,i)}}])&&ki(e.prototype,r),n&&ki(e,n),u}(Pi);function Ei(t){return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Bi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Di(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ti(t,e){return(Ti=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ci(t,e){if(e&&("object"===Ei(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ii(t){return(Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Xi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ti(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ii(o);if(i){var r=Ii(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ci(this,t)});function u(){return Bi(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"fill-color"}}],(r=[{key:"getDefaultParameters",value:function(){return{color:"transparent"}}},{key:"callback",value:function(t,e,r){var n,o,i,a,u;for("transparent"===r.color?i={r:0,g:0,b:0,a:0}:(a=r.color,(i={r:(u=parseInt(a.replace("#",""),16))>>16,g:u>>8&255,b:255&u}).a=255),o=0;o<e;o+=1)for(n=0;n<t;n+=1)this.setPixel(n,o,i)}}])&&Di(e.prototype,r),n&&Di(e,n),u}(Pi);function Yi(t){return(Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ai(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ni(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Gi(t,e){return(Gi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Li(t,e){if(e&&("object"===Yi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function qi(t){return(qi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Hi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gi(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qi(o);if(i){var r=qi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Li(this,t)});function u(){return Ai(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"flip"}}],(r=[{key:"getDefaultParameters",value:function(){return{operation:"FLIP_H"}}},{key:"callback",value:function(t,e,r){var n,o,i=0,a=0,u=t,c=e;for(r.operation,a=0;a<e;a+=1)for(i=0;i<t;i+=1){switch(n=a,o=i,r.operation){case"FLIP_H":o=u-i-1;break;case"FLIP_V":n=c-a-1;break;case"FLIP_HV":n=i,o=a;break;case"FLIP_90CW":n=i,o=c-a-1;break;case"FLIP_90CCW":n=u-i-1,o=a;break;case"FLIP_180":n=c-a-1,o=u-i-1}this.setPixel(o,n,this.getOriginalPixel(i,a))}}}])&&Ni(e.prototype,r),n&&Ni(e,n),u}(Pi);function zi(t){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vi(t,e){return(Vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ui(t,e){if(e&&("object"===zi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ji(t){return(Ji=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Ki=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vi(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ji(o);if(i){var r=Ji(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ui(this,t)});function u(){return Wi(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"block"}}],(r=[{key:"getDefaultParameters",value:function(){return{blockSize:5}}},{key:"callback",value:function(t,e,r){var n,o,i,a,u,c,f,l,s,y,p;for(o=0;o<e;o+=r.blockSize)for(n=0;n<t;n+=r.blockSize){for(u=(i=Math.min(r.blockSize,t-n))*(a=Math.min(r.blockSize,e-o)),c=0,f=0,l=0,y=0;y<a;y+=1)for(p=0;p<i;p+=1)c+=255&(s=this.getOriginalPixel(n+p,o+y)).r,f+=255&s.g,l+=255&s.b;for(c/=u,f/=u,l/=u,y=0;y<a;y+=1)for(p=0;p<i;p+=1)this.setPixel(n+p,o+y,{r:c,g:f,b:l,a:255})}}}])&&Fi(e.prototype,r),n&&Fi(e,n),u}(Pi);function Qi(t){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function $i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ta(t,e){return(ta=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ea(t,e){if(e&&("object"===Qi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ra(t)}function ra(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function na(t){return(na=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function oa(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const ia=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ta(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=na(o);if(i){var r=na(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ea(this,t)});function u(){var t;Zi(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return oa(ra(t=a.call.apply(a,[this].concat(r))),"data",{leftBorder:0,rightBorder:0,topBorder:0,bottomBorder:0}),t}return e=u,n=[{key:"getName",value:function(){return"border"}}],(r=[{key:"getDefaultParameters",value:function(){return{leftBorder:10,rightBorder:10,topBorder:10,bottomBorder:10,borderColor:{r:0,b:0,g:0,a:255}}}},{key:"before",value:function(t,e,r,n){return{leftBorder:0|t.leftBorder,rightBorder:0|t.rightBorder,topBorder:0|t.rightBorder,bottomBorder:0|t.bottomBorder}}},{key:"callback",value:function(t,e,r){var n,o;for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)this.data.leftBorder>0&&n<this.data.leftBorder&&this.setPixel(n,o,r.borderColor),this.data.rightBorder>0&&t-this.data.rightBorder<n&&this.setPixel(n,o,r.borderColor),this.data.topBorder>0&&o<this.data.topBorder&&this.setPixel(n,o,r.borderColor),this.data.bottomBorder>0&&e-this.data.bottomBorder<o&&this.setPixel(n,o,r.borderColor)}}])&&$i(e.prototype,r),n&&$i(e,n),u}(Pi);function aa(t){return(aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ua(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ca(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fa(t,e){return(fa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function la(t,e){if(e&&("object"===aa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function sa(t){return(sa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const ya=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fa(t,e)}(c,t);var e,r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=sa(o);if(i){var r=sa(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return la(this,t)});function c(){return ua(this,c),a.apply(this,arguments)}return e=c,n=[{key:"getName",value:function(){return"emboss"}}],(r=[{key:"getDefaultParameters",value:function(){return{azimuth:135*Math.PI/180,elevation:30*Math.PI/180,width45:3,emboss:!0}}},{key:"callback",value:function(t,e,r){var n,o,i,a,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j,_=t,k=[],S=255.9,R=0,x=0;for(f=Math.cos(r.azimuth)*Math.cos(r.elevation)*S|0,l=Math.sin(r.azimuth)*Math.cos(r.elevation)*S|0,s=Math.sin(r.elevation)*S|0,y=(c=1530/r.width45|0)*c,p=c*s,g=s,o=0;o<e;o+=1)for(n=0;n<t;n+=1)k.push(0|u(this.getOriginalPixel(n,o)));for(o=0;o<e;o+=1,R+=_)for(v=(d=(b=R)+_)+_,n=0;n<t;n+=1,b+=1,d+=1,v+=1)0!=o&&o<e-2&&0!=n&&n<t-2?(i=k[b-1]+k[d-1]+k[v-1]-k[b+1]-k[d+1]-k[v+1],a=k[v-1]+k[v]+k[v+1]-k[b-1]-k[b]-k[b+1],m=0==i&&0==a?g:(h=i*f+a*l+p)<0?0:h/Math.sqrt(i*i+a*a+y)):m=g,r.emboss?(O=(w=this.getOriginalPixelByIndex(x)).r*m>>8,P=w.g*m>>8,j=w.b*m>>8,this.setPixelByIndex(x++,{r:O,g:P,b:j,a:w.a})):this.setPixelByIndex(x++,{r:m,g:m<<8,b:m<<16,a:255})}}])&&ca(e.prototype,r),n&&ca(e,n),c}(Pi);function pa(t){return(pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ha(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ba(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function da(t,e){return(da=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function va(t,e){if(e&&("object"===pa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ma(t){return(ma=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const ga=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&da(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ma(o);if(i){var r=ma(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return va(this,t)});function u(){return ha(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"component-stretching"}}],(r=[{key:"callback",value:function(t,e,r){var n,o,i,a=1/0,u=1/0,c=1/0,f=-1,l=-1,s=-1,y=function(t,e,r){return 255*(t-e)/(r-e)};for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)i=this.getPixel(n,o),a=Math.min(i.r,a),u=Math.min(i.g,u),c=Math.min(i.b,c),f=Math.max(i.r,f),l=Math.max(i.g,l),s=Math.max(i.b,s);for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)(i=this.getPixel(n,o)).r=y(i.r,a,f),i.g=y(i.g,u,l),i.b=y(i.b,c,s),this.setPixel(n,o,i)}}])&&ba(e.prototype,r),n&&ba(e,n),u}(Pi);var wa={};function Oa(t){if(wa[t.getName()])throw"Effect: ".concat(t.getName()," exists already!");wa[t.getName()]=t}Oa(E),Oa(Y),Oa(F),Oa(et),Oa(lt),Oa(gt),Oa(St),Oa(Tt),Oa(qt),Oa(Qt),Oa(oe),Oa(se),Oa(we),Oa(Re),Oa(Ce),Oa(Le),Oa(Ke),Oa(Ur),Oa(ir),Oa(nn),Oa(dn),Oa(kn),Oa(Dn),Oa(Ln),Oa(Kn),Oa(io),Oa(ho),Oa(_o),Oa(hr),Oa(Or),Oa(To),Oa(qo),Oa(Jo),Oa(oi),Oa(pi),Oa(Er),Oa(Mi),Oa(Xi),Oa(Hi),Oa(Ki),Oa(ia),Oa(ya),Oa(ga);const Pa=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e;return(e=[{key:"get",value:function(t){return wa[t]}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t,e),t}();function ja(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const _a=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ja(this,"obj",null),ja(this,"layer",null),ja(this,"x",0),ja(this,"y",0),ja(this,"opts",{}),ja(this,"effects",[]),this.obj=e,this.layer=r,this.x=n,this.y=o,this.opts=i}var e;return(e=[{key:"getObject",value:function(){return this.obj}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.obj.getWidth()}},{key:"getHeight",value:function(){return this.obj.getHeight()}},{key:"exportObject",value:function(){for(var t=this.obj.getImageData(),e=0;e<this.effects.length;e+=1)t=this.effects[e].effect.run(t,this.effects[e].parameters);return t}},{key:"applyEffect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.effects.push({name:t,effect:new(Pa.get(t)),parameters:e}),this}},{key:"moveXY",value:function(t,e){return this.moveX(t),this.moveY(e),this}},{key:"moveX",value:function(t){return this.x+=0|t,this}},{key:"moveY",value:function(t){return this.y+=0|t,this}},{key:"setXY",value:function(t,e){return this.setX(t),this.setY(e),this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"resize",value:function(t,e,r,n){var o=t/this.getWidth(),i=e/this.getHeight();return n&&this.moveXY(-this.getX()*o,-this.getY()*i),this.getObject().resize(t,e,r),this}},{key:"crop",value:function(t,e,r,n){var o=this.getObject(),i=function(t,e,r,n,o,i){var a,u,c,f,l,s,y=t.width,p=e.width;for(u=n,f=0;u<n+i&&f<i;u+=1,f+=1)for(a=r,c=0;a<r+o&&c<o;a+=1,c+=1)l=u*y*4+4*a,s=f*p*4+4*c,e.data[s]=t.data[l],e.data[s+1]=t.data[l+1],e.data[s+2]=t.data[l+2],e.data[s+3]=t.data[l+3];return e}(o.getImageData(),new l(r,n).getContext().createImageData(r,n),t,e,r,n);return o.setImageData(i).setWidth(r).setHeight(n),this.setXY(t,e),this}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}();function ka(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sa(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ra=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{backgroundColor:"",blendingMode:""};ka(this,t),Sa(this,"objects",[]),Sa(this,"effects",[]),Sa(this,"x",0),Sa(this,"y",0),Sa(this,"canvas",null),Sa(this,"imageData",null),Sa(this,"width",0),Sa(this,"height",0),Sa(this,"parameters",{backgroundColor:"",blendingMode:""}),this.initialize(e,r,n),n.backgroundColor&&"transparent"!==n.backgroundColor&&this.applyEffect("fill-color",{color:n.backgroundColor})}var n;return(n=[{key:"initialize",value:function(t,e,r){this.canvas=new l(t,e),this.imageData=this.canvas.getContext().createImageData(t,e),this.width=t,this.height=e,this.parameters=r}},{key:"put",value:function(t,e,r){var n=new _a(t,this,e,r,{});return this.objects.push(n),n}},{key:"exportLayer",value:function(){for(var t=0;t<this.objects.length;t+=1){var n=this.objects[t];this.imageData=e({width:this.width,height:this.height,imageData:this.imageData},{x:n.getX(),y:n.getY(),width:n.getWidth(),height:n.getHeight(),imageData:n.exportObject()},r)}for(var o=0;o<this.effects.length;o++)this.imageData=this.effects[o].effect.run(this.imageData,this.effects[o].parameters);return this.imageData}},{key:"applyEffect",value:function(t,e){return this.effects.push({name:t,effect:new(Pa.get(t)),parameters:e}),this}},{key:"resize",value:function(t,e,r){this.canvas.destroy(),this.canvas=null,this.imageData=null,this.initialize(t,e,this.parameters);for(var n=0;n<this.objects.length;n+=1)this.objects[n].resize(t,e,r,!0);return this}},{key:"crop",value:function(t,e,r,n){for(var o=0;o<this.objects.length;o+=1)this.objects[o].crop(t,e,r,n);return this}},{key:"moveXY",value:function(t,e){return this.moveX(t),this.moveY(e),this}},{key:"moveX",value:function(t){return this.x+=0|t,this}},{key:"moveY",value:function(t){return this.y+=0|t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setBlendingMode",value:function(t){return this.parameters.blendingMode=t,this}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getParameter",value:function(t){return this.parameters[t]}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,n),t}();function xa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ma(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ea=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};xa(this,t),Ma(this,"imageData",null),Ma(this,"effects",[]),Ma(this,"layers",[]),Ma(this,"startTime",new Date),Ma(this,"parameters",{}),Ma(this,"width",0),Ma(this,"height",0),Ma(this,"canvas",null),this.initialize(e,r,n)}var n;return(n=[{key:"initialize",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.parameters=r,this.width=t,this.height=e,this.canvas=new l(t,e),this.imageData=this.canvas.getContext().getImageData(0,0,t,e)}},{key:"createLayer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{backgroundColor:"",blendingMode:""},e=new Ra(this.width,this.height,t);return this.layers.push(e),e}},{key:"getTime",value:function(){return(new Date).getTime()-this.startTime.getTime()}},{key:"save",value:function(t){if(c())throw new Error("Available only in node.js environment");for(var n=0;n<this.layers.length;n++)this.imageData=e({width:this.width,height:this.height,imageData:this.imageData},{x:this.layers[n].getX(),y:this.layers[n].getY(),width:this.layers[n].getWidth(),height:this.layers[n].getHeight(),imageData:this.layers[n].exportLayer(),blendingMode:this.layers[n].getParameter("blendingMode")},r);for(var i=0;i<this.effects.length;i++)this.imageData=this.effects[i].effect.run(this.imageData,this.effects[i].parameters);this.canvas.getContext().putImageData(this.imageData,0,0);var a=o(747),u=this.canvas.toDataURL().replace(/^data:image\/\w+;base64,/,""),f=Buffer.from(u,"base64");a.writeFileSync(t,f)}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";if(!c())throw new Error("Available only in browser environment");for(var n=new window.Image,o=0;o<this.layers.length;o++)this.imageData=e({width:this.width,height:this.height,imageData:this.imageData},{x:this.layers[o].getX(),y:this.layers[o].getY(),width:this.layers[o].getWidth(),height:this.layers[o].getHeight(),imageData:this.layers[o].exportLayer(),blendingMode:this.layers[o].getParameter("blendingMode")},r);for(var i=0;i<this.effects.length;i++)this.imageData=this.effects[i].effect.run(this.imageData,this.effects[i].parameters);return this.canvas.getContext().putImageData(this.imageData,0,0),n.src=this.canvas.toDataURL(t),n}},{key:"applyEffect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.effects.push({name:t,effect:new(Pa.get(t)),parameters:e}),this}},{key:"resize",value:function(t,e,r){this.canvas.destroy(),this.canvas=null,this.imageData=null,this.initialize(t,e);for(var n=0;n<this.layers.length;n+=1)this.layers[n].resize(t,e,r);return this}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,n),t}();function Ba(t,e,r,n){var o,i,a,u,c=t.width,f=c/r,l=t.height/n;for(u=0;u<n;u+=1)for(a=0;a<r;a+=1)o=Math.floor(u*l)*c*4+4*Math.floor(a*f),i=u*r*4+4*a,e.data[i+0]=t.data[o+0],e.data[i+1]=t.data[o+1],e.data[i+2]=t.data[o+2],e.data[i+3]=t.data[o+3];return e}function Da(t,e,r,n){var o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g=t.width,w=t.height,O=g/r,P=w/n;for(v=0;v<n;v+=1)for(m=0;m<r;m+=1)a=v*P,f=(i=m*O)-(u=Math.floor(i)),l=a-(c=Math.floor(a)),(s=u+1)>=g&&(s=u),(y=c+1)>=w&&(y=c),p=4*(c*g+u),h=4*(c*g+s),b=4*(y*g+u),d=4*(y*g+s),o=4*(v*r+m),e.data[o]=(1-l)*((1-f)*t.data[p]+f*t.data[h])+l*((1-f)*t.data[b]+f*t.data[d]),e.data[o+1]=(1-l)*((1-f)*t.data[p+1]+f*t.data[h+1])+l*((1-f)*t.data[b+1]+f*t.data[d+1]),e.data[o+2]=(1-l)*((1-f)*t.data[p+2]+f*t.data[h+2])+l*((1-f)*t.data[b+2]+f*t.data[d+2]),e.data[o+3]=(1-l)*((1-f)*t.data[p+3]+f*t.data[h+3])+l*((1-f)*t.data[b+3]+f*t.data[d+3]);return e}function Ta(t,e,r,n){var o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j,_,k,S=function(t,e,r,n){return e+(r-t)*n+(t-2*e+r)*n*n},R=function(t,e,r,n){var o=S(t,e,r,n);return o>255?255:o<0?0:Math.floor(o)},x=t.width,M=x/r,E=t.height/n;for(_=0;_<n;_+=1)for(k=0;k<r;k+=1)i=_*E,y=.5*((o=k*M)-(c=Math.floor(o))),p=.5*(i-(f=Math.floor(i))),h=4*((u=f-1>=0?f-1:f)*x+(a=c-1>=0?c-1:c)),b=4*(u*x+c),d=4*(u*x+(l=c+1>=x?c:c+1)),v=4*(f*x+a),m=4*(f*x+c),g=4*(f*x+l),w=4*((s=f+1>=x?f:f+1)*x+a),O=4*(s*x+c),P=4*(s*x+l),j=4*(_*r+k),e.data[j]=R(S(t.data[h],t.data[b],t.data[d],y),S(t.data[v],t.data[m],t.data[g],y),S(t.data[w],t.data[O],t.data[P],y),p),e.data[j+1]=R(S(t.data[h+1],t.data[b+1],t.data[d+1],y),S(t.data[v+1],t.data[m+1],t.data[g+1],y),S(t.data[w+1],t.data[O+1],t.data[P+1],y),p),e.data[j+2]=R(S(t.data[h+2],t.data[b+2],t.data[d+2],y),S(t.data[v+2],t.data[m+2],t.data[g+2],y),S(t.data[w+2],t.data[O+2],t.data[P+2],y),p),e.data[j+3]=R(S(t.data[h+3],t.data[b+3],t.data[d+3],y),S(t.data[v+3],t.data[m+3],t.data[g+3],y),S(t.data[w+3],t.data[O+3],t.data[P+3],y),p);return e}function Ca(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ia(t){return(Ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xa(t,e){return(Xa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ya(t,e){if(e&&("object"===Ia(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Aa(t)}function Aa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Na(t){return(Na=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ga(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const La=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xa(t,e)}(a,t);var e,r,n,i=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Na(r);if(n){var o=Na(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return Ya(this,t)});function a(){var t;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Ga(Aa(t=i.call(this)),"url",null),Ga(Aa(t),"image",null),c())t.image=new window.Image,t.image.style.position="absolute",t.image.style.left="-99999px",t.image.style.top="-99999px";else{var e=o(338);t.image=new e.Image}return t}return(e=[{key:"load",value:function(t,e){var r=this,n=function(){r.setWidth(c()?r.image.clientWidth:r.image.width),r.setHeight(c()?r.image.clientHeight:r.image.height),r.canvas=new l(r.getWidth(),r.getHeight()),r.canvas.getContext().drawImage(r.image,0,0,r.getWidth(),r.getHeight()),c()&&document.body.removeChild(r.image),"function"==typeof e&&e.call(r)};if(this.url=t,c())document.body.appendChild(this.image),this.image.onload=function(){n()},this.image.src=t;else{var i=o(747);this.image.src=i.readFileSync(t),n()}}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(a.prototype,e),a}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ca(this,"imageData",null),Ca(this,"canvas",null),Ca(this,"width",0),Ca(this,"height",0)}var e;return(e=[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getImageData",value:function(){return this.imageData||(this.imageData=this.canvas.getContext().getImageData(0,0,this.getWidth(),this.getHeight())),this.imageData}},{key:"setImageData",value:function(t){return this.imageData=t,this}},{key:"resize",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest-neighbour",n=this.getImageData(),o=new l(t,e),i=o.getContext().createImageData(t,e);switch(r){case"nearest-neighbour":i=Ba(n,i,t,e);break;case"bilinear-interpolation":i=Da(n,i,t,e);break;case"biquadratic-interpolation":i=Ta(n,i,t,e);break;default:return o.destroy(),this}return o.destroy(),this.setWidth(t).setHeight(e).setImageData(i)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}())})(),t.exports=i})()},338:t=>{"use strict";t.exports=require("canvas")},747:t=>{"use strict";t.exports=require("fs")}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n);var t=r(75),e=new t.Image;e.load("../demo/test.png",(function(){var r=new t.Project(e.getWidth(),e.getHeight()),n=r.createLayer().put(e,0,0);n.applyEffect("edge"),n.applyEffect("gray-scale"),n.applyEffect("invert"),r.save("../demo/node_result_1.png")}));var o=new t.Image;o.load("../demo/test.png",(function(){var e=new t.Project(o.getWidth(),o.getHeight()),r=e.createLayer().put(o,0,0);r.applyEffect("component-stretching"),r.applyEffect("auto-white-balance"),r.applyEffect("auto-contrast"),e.save("../demo/node_result_2.png")}))})();var o=exports;for(var i in n)o[i]=n[i];n.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=node-demo.js.map