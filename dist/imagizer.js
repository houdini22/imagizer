(()=>{"use strict";var t={338:t=>{t.exports=require("canvas")},747:t=>{t.exports=require("fs")}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{r.r(n),r.d(n,{Image:()=>Qa,Project:()=>Aa});var t={lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return t*e/255},average:function(t,e){return t+e/2},add:function(t,e){return Math.min(255,t+e)},subtract:function(t,e){return t+e<255?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-2*t*e/255},overlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},softLight:function(t,e){return e<128?2*(64+(t>>1))*(e/255):255-2*(255-(64+(t>>1)))*(255-e)/255},hardLight:function(e,r){return t.softLight(r,e)},colorDodge:function(t,e){return 255===e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0===e?e:Math.max(0,255-(255-t<<8)/e)},linearDodge:function(e,r){return t.add(e,r)},linearBurn:function(e,r){return t.subtract(e,r)},linearLight:function(e,r){return r<128?t.linearBurn(e,2*r):t.linearDodge(e,2*(r-128))},vividLight:function(e,r){return r<128?t.colorBurn(e,2*r):t.colorDodge(e,2*(r-128))},pinLight:function(e,r){return r<128?t.darken(e,2*r):t.lighten(e,2*(r-128))},hardMix:function(e,r){return t.vividLight(e,r)<128?0:255},reflect:function(t,e){return 255===e?e:Math.min(255,t*t/(255-e))},glow:function(e,r){return t.reflect(r,e)},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}};function e(t,e,r){var n,o,i,a,u,c,f;for(o=e.y,a=0;o<t.height&&a<e.height;o+=1,a+=1)for(n=e.x,i=0;n<t.width&&i<e.width;n+=1,i+=1)i<e.width&&a<e.height&&(u=o*t.width*4+4*n,c=a*e.width*4+4*i,!1!==(f=r({r:t.imageData.data[u+0],g:t.imageData.data[u+1],b:t.imageData.data[u+2],a:t.imageData.data[u+3]},{r:e.imageData.data[c+0],g:e.imageData.data[c+1],b:e.imageData.data[c+2],a:e.imageData.data[c+3]},n,o,{blendingMode:e.blendingMode}))&&(t.imageData.data[u+0]=f.r,t.imageData.data[u+1]=f.g,t.imageData.data[u+2]=f.b,t.imageData.data[u+3]=f.a));return t.imageData}function o(e,r,n,o,i){if(0===r.a)return!1;var a,u,c,f=r.a/255,l=e.a/255*(1-f),s=f+e.a*(1-f)/255;switch(i.blendingMode){case"lighten":case"darken":case"multiply":case"average":case"add":case"subtract":case"difference":case"negation":case"screen":case"exclusion":case"overlay":case"softLight":case"hardLight":case"colorDodge":case"colorBurn":case"linearDodge":case"linearBurn":case"linearLight":case"vividLight":case"pinLight":case"hardMix":case"reflect":case"glow":case"phoenix":r.r=t[i.blendingMode](e.r,r.r),r.g=t[i.blendingMode](e.g,r.g),r.b=t[i.blendingMode](e.b,r.b)}var y=e.r,p=e.g,h=e.b;return a=r.r*f+y*l,u=r.g*f+p*l,c=r.b*f+h*l,a=0===s?0:a/s,u=0===s?0:u/s,c=0===s?0:c/s,{r:0|Math.min(Math.max(0,a),255),g:0|Math.min(Math.max(0,u),255),b:0|Math.min(Math.max(0,c),255),a:255*s|0}}function i(t,e){return(t-=Math.floor(t/e)*e)<0?t+e:t}function a(t){var e=i(t,1);return 2*(e<.5?e:1-e)}function u(t){return(t.r+t.g+t.b)/3}function c(){return"undefined"!=typeof window}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function l(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const s=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"canvas",null),l(this,"context",null),l(this,"width",0),l(this,"height",0),this.initialize(e,r)}var e,n;return e=t,(n=[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(c())this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="-99999px",this.canvas.style.top="-99999px",this.setWidth(t),this.setHeight(e),document.body.appendChild(this.canvas);else{var n=r(338),o=n.createCanvas;this.canvas=o(t,e)}}},{key:"setWidth",value:function(t){return this.canvas.setAttribute("width",""+t),this.width=t,this}},{key:"setHeight",value:function(t){return this.canvas.setAttribute("height",""+t),this.height=t,this}},{key:"getContext",value:function(){return this.context||(this.context=this.canvas.getContext("2d")),this.context}},{key:"getCanvas",value:function(){return this.canvas}},{key:"toDataURL",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";return this.canvas.toDataURL(t)}},{key:"destroy",value:function(){c()&&document.body.removeChild(this.canvas),this.canvas=null,this.context=null}}])&&f(e.prototype,n),t}();function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const b=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,t),h(this,"opts",{}),this.opts=e}var e,r,n;return e=t,n=[{key:"getName",value:function(){throw"Extend it."}}],(r=[{key:"getDefaultParameters",value:function(){return{}}},{key:"before",value:function(t,e,r,n){return{}}},{key:"run",value:function(t,e){return null}}])&&p(e.prototype,r),n&&p(e,n),t}();function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_(n);if(o){var r=_(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return j(this,t)});function a(){return w(this,a),i.apply(this,arguments)}return e=a,(r=[{key:"callback",value:function(t,e,r,n,o,i){throw"Extend it."}},{key:"run",value:function(t,e){var r,n,o,i;e=e=m(m({},this.getDefaultParameters()),e);var a=new Uint8ClampedArray(t.data),u=function(e,r){return r*t.width*4+4*e},c=function(t){return 0|Math.min(Math.max(t,0),255)},f={getPixel:function(t,e){var r=u(t,e);return{r:a[r+0],g:a[r+1],b:a[r+2],a:a[r+3]}},getOriginalPixel:function(e,r){var n=u(e,r);return{r:t.data[n+0],g:t.data[n+1],b:t.data[n+2],a:t.data[n+3]}},setPixel:function(t,e,r){var n=u(t,e);a[n+0]=c(r.r),a[n+1]=c(r.g),a[n+2]=c(r.b),a[n+3]=c(r.a)},data:null,width:t.width,height:t.height};for(f.data=this.before.call(f,e,t.width,t.height,t),n=0;n<t.height;n+=1)for(r=0;r<t.width;r+=1)o=u(r,n),"object"===d(i=this.callback.call(f,{r:a[o+0],g:a[o+1],b:a[o+2],a:a[o+3]},r,n,e,t.width,t.height))&&(a[o+0]=c(i.r),a[o+1]=c(i.g),a[o+2]=c(i.b),a[o+3]=c(i.a));return t.data.set(a),t}}])&&O(e.prototype,r),a}(b);function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(t,e){if(e&&("object"===S(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=B(o);if(i){var r=B(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return E(this,t)});function u(){return R(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"gray-scale"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){var a=.299*t.r+.587*t.g+.114*t.b;return{r:a,g:a,b:a,a:t.a}}}])&&x(e.prototype,r),n&&x(e,n),u}(k);function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Y(t,e){if(e&&("object"===T(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function A(t){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(o);if(i){var r=A(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Y(this,t)});function u(){return C(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"sepia"}}],(r=[{key:"getDefaultParameters",value:function(){return{sepiaValue:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=.299*t.r+.587*t.g+.114*t.b;return t.r=a+2*n.sepiaValue,t.g=a+n.sepiaValue,t.b=a,t}}])&&I(e.prototype,r),n&&I(e,n),u}(k);function G(t){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return W(t)}function W(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const U=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=F(o);if(i){var r=F(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return z(this,t)});function u(){var t;q(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return V(W(t=a.call.apply(a,[this].concat(r))),"data",{factor:1}),t}return e=u,n=[{key:"getName",value:function(){return"contrast"}}],(r=[{key:"getDefaultParameters",value:function(){return{contrast:.5}}},{key:"before",value:function(t){return{factor:259*(255*t.contrast+255)/(255*(259-255*t.contrast))}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=this.data.factor*(t.r-128)+128,t.g=this.data.factor*(t.g-128)+128,t.b=this.data.factor*(t.b-128)+128,t}}])&&L(e.prototype,r),n&&L(e,n),u}(k);function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Z(t,e){return(Z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function $(t,e){if(e&&("object"===J(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tt(t)}function tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Z(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=et(o);if(i){var r=et(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return $(this,t)});function u(){var t;K(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return rt(tt(t=a.call.apply(a,[this].concat(r))),"data",{brightness:0}),t}return e=u,n=[{key:"getName",value:function(){return"brightness"}}],(r=[{key:"getDefaultParameters",value:function(){return{brightness:.5}}},{key:"before",value:function(t){return{brightness:255*t.brightness}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=t.r+this.data.brightness,t.g=t.g+this.data.brightness,t.b=t.b+this.data.brightness,t}}])&&Q(e.prototype,r),n&&Q(e,n),u}(k);function ot(t){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ut(t,e){return(ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ct(t,e){if(e&&("object"===ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ft(t)}function ft(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lt(t){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function st(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lt(o);if(i){var r=lt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ct(this,t)});function u(){var t;it(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return st(ft(t=a.call.apply(a,[this].concat(r))),"data",{map:{},div:{},sum:0}),t}return e=u,n=[{key:"getName",value:function(){return"diffusion"}}],(r=[{key:"getDefaultParameters",value:function(){return{matrix:[0,0,0,0,0,7,3,5,1],levels:6,colorDither:!0,granulate:!0}}},{key:"before",value:function(t,e,r,n){for(var o=0,i=[],a=[],u=0;u<t.matrix.length;u+=1)o+=t.matrix[u];for(var c=0;c<t.levels;c+=1)i[c]=255*c/(t.levels-1)|0;for(var f=0;f<256;f+=1)a[f]=t.levels*f/256|0;return{sum:o,map:i,div:a}}},{key:"callback",value:function(t,e,r,n,o,i){var a,u,c,f,l,s,y,p,h,b,d,v,m,g=t.r,w=t.g,O=t.b,P=this.data;if(n.colorDither||(g=m=(g+w+O)/3,w=m,O=m),l=g-(a=P.map[P.div[g]]),s=w-(u=P.map[P.div[w]]),y=O-(c=P.map[P.div[O]]),n.granulate)for(p=-1;p<=1;p+=1)if(!((b=p+r)<0||b>=i))for(h=-1;h<=1;h+=1)(d=h+e)<0||d>=o||0!==(v=n.matrix[3*(p+1)+h+1])&&((f=this.getPixel(d,b)).r+=l*v/P.sum,f.g+=s*v/P.sum,f.b+=y*v/P.sum,this.setPixel(d,b,f));return{r:a,g:u,b:c,a:t.a}}}])&&at(e.prototype,r),n&&at(e,n),u}(k);function pt(t){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dt(t,e){return(dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function vt(t,e){if(e&&("object"===pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return mt(t)}function mt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gt(o);if(i){var r=gt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return vt(this,t)});function u(){var t;ht(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return wt(mt(t=a.call.apply(a,[this].concat(r))),"data",{cols:0,rows:0,map:{},mod:{},div:{}}),t}return e=u,n=[{key:"getName",value:function(){return"dither"}}],(r=[{key:"getDefaultParameters",value:function(){return{matrices:{ditherMagic4x4Matrix:[0,14,3,13,11,5,8,6,12,2,15,1,7,9,4,10],ditherOrdered4x4Matrix:[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],ditherLines4x4Matrix:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],dither90Halftone6x6Matrix:[29,18,12,19,30,34,17,7,4,8,20,28,11,3,0,1,9,27,16,6,2,5,13,26,25,15,10,14,21,31,33,25,24,23,33,36],ditherOrdered6x6Matrix:[1,59,15,55,2,56,12,52,33,17,47,31,34,18,44,28,9,49,5,63,10,50,6,60,41,25,37,21,42,26,38,22,3,57,13,53,0,58,14,54,35,19,45,29,32,16,46,30,11,51,7,61,8,48,4,62,43,27,39,23,40,24,36,20],ditherOrdered8x8Matrix:[1,235,59,219,15,231,55,215,2,232,56,216,12,228,52,212,129,65,187,123,143,79,183,119,130,66,184,120,140,76,180,116,33,193,17,251,47,207,31,247,34,194,18,248,44,204,28,244,161,97,145,81,175,111,159,95,162,98,146,82,172,108,156,92,9,225,49,209,5,239,63,223,10,226,50,210,6,236,60,220,137,73,177,113,133,69,191,127,138,74,178,114,134,70,188,124,41,201,25,241,37,197,21,255,42,202,26,242,38,198,22,252,169,105,153,89,165,101,149,85,170,106,154,90,166,102,150,86,3,233,57,217,13,229,53,213,0,234,58,218,14,230,54,214,131,67,185,121,141,77,181,117,128,64,186,122,142,78,182,118,35,195,19,249,45,205,29,245,32,192,16,250,46,206,30,246,163,99,147,83,173,109,157,93,160,96,144,80,174,110,158,94,11,227,51,211,7,237,61,221,8,224,48,208,4,238,62,222,139,75,179,115,135,71,189,125,136,72,176,112,132,68,190,126,43,203,27,243,39,199,23,253,40,200,24,240,36,196,20,254,171,107,155,91,167,103,151,87,168,104,152,88,164,100,148,84],ditherCluster3Matrix:[9,11,10,8,6,7,12,17,16,5,0,1,13,14,15,4,3,2,8,6,7,9,11,10,5,0,1,12,17,16,4,3,2,13,14,15],ditherCluster4Matrix:[18,20,19,16,13,11,12,15,27,28,29,22,4,3,2,9,26,31,30,21,5,0,1,10,23,25,24,17,8,6,7,14,13,11,12,15,18,20,19,16,4,3,2,9,27,28,29,22,5,0,1,10,26,31,30,21,8,6,7,14,23,25,24,17],ditherCluster8Matrix:[64,69,77,87,86,76,68,67,63,58,50,40,41,51,59,60,70,94,100,109,108,99,93,75,57,33,27,18,19,28,34,52,78,101,114,116,115,112,98,83,49,26,13,11,12,15,29,44,88,110,123,124,125,118,107,85,39,17,4,3,2,9,20,42,89,111,122,127,126,117,106,84,38,16,5,0,1,10,21,43,79,102,119,121,120,113,97,82,48,25,8,6,7,14,30,45,71,95,103,104,105,96,92,74,56,32,24,23,22,31,35,53,65,72,80,90,91,81,73,66,62,55,47,37,36,46,54,61,63,58,50,40,41,51,59,60,64,69,77,87,86,76,68,67,57,33,27,18,19,28,34,52,70,94,100,109,108,99,93,75,49,26,13,11,12,15,29,44,78,101,114,116,115,112,98,83,39,17,4,3,2,9,20,42,88,110,123,124,125,118,107,85,38,16,5,0,1,10,21,43,89,111,122,127,126,117,106,84,48,25,8,6,7,14,30,45,79,102,119,121,120,113,97,82,56,32,24,23,22,31,35,53,71,95,103,104,105,96,92,74,62,55,47,37,36,46,54,61,65,72,80,90,91,81,73,66]},levels:6,matrix:"ditherMagic4x4Matrix",colorDither:!0}}},{key:"before",value:function(t,e,r,n){var o,i,a,u=t.matrix,c=[],f=[],l=[];for("string"==typeof u&&(u=t.matrices[u]),o=Math.sqrt(u.length),i=Math.sqrt(u.length),a=0;a<t.levels;a+=1)c[a]=255*a/(t.levels-1);for(a=0;a<256;a+=1)f[a]=(t.levels-1)*a/256|0,l[a]=a*(o*i+1)/256|0;return{matrix:u,map:c,div:f,mod:l,cols:i,rows:o}}},{key:"callback",value:function(t,e,r,n,o,i){var a,u=e%this.data.cols,c=r%this.data.rows,f=n.matrix[c*this.data.cols+u],l=t.r,s=t.g,y=t.b,p={a:t.a,r:0,g:0,b:0};return n.colorDither?(p.r=this.data.map[this.data.mod[l]>f?this.data.div[l]+1:this.data.div[l]],p.g=this.data.map[this.data.mod[s]>f?this.data.div[s]+1:this.data.div[s]],p.b=this.data.map[this.data.mod[y]>f?this.data.div[y]+1:this.data.div[y]]):(a=(l+s+y)/3,p.r=p.g=p.b=this.data.map[this.data.mod[a]>f?this.data.div[a]+1:this.data.div[a]]),p}}])&&bt(e.prototype,r),n&&bt(e,n),u}(k);function Pt(t){return(Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kt(t,e){return(kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function St(t,e){if(e&&("object"===Pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rt(t){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Rt(o);if(i){var r=Rt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return St(this,t)});function u(){return jt(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"exposure"}}],(r=[{key:"getDefaultParameters",value:function(){return{exposure:1}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=255*(1-Math.exp(-t.r/255*n.exposure)),t.g=255*(1-Math.exp(-t.g/255*n.exposure)),t.b=255*(1-Math.exp(-t.b/255*n.exposure)),t}}])&&_t(e.prototype,r),n&&_t(e,n),u}(k);function Mt(t){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dt(t,e){return(Dt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Tt(t,e){if(e&&("object"===Mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ct(t){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const It=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ct(o);if(i){var r=Ct(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Tt(this,t)});function u(){return Et(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"gain"}}],(r=[{key:"getDefaultParameters",value:function(){return{gain:1,bias:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=(1/n.gain-2)*(1-2*t.r/255),u=(1/n.gain-2)*(1-2*t.g/255),c=(1/n.gain-2)*(1-2*t.b/255);return a=t.r/255<.5?t.r/255/a+1:(a-t.r/255)/(a-1),u=t.g/255<.5?t.g/255/u+1:(u-t.g/255)/(u-1),c=t.b/255<.5?t.b/255/c+1:(c-t.b/255)/(c-1),a/=(1/n.bias-2)*(1-a)+1,u/=(1/n.bias-2)*(1-u)+1,c/=(1/n.bias-2)*(1-c)+1,t.r=255*a,t.g=255*u,t.b=255*c,t}}])&&Bt(e.prototype,r),n&&Bt(e,n),u}(k);function Xt(t){return(Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function At(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nt(t,e){return(Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Gt(t,e){if(e&&("object"===Xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return qt(t)}function qt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Lt(t){return(Lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ht(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const zt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Lt(o);if(i){var r=Lt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gt(this,t)});function u(){var t;Yt(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Ht(qt(t=a.call.apply(a,[this].concat(r))),"data",{table:{r:{},g:{},b:{}}}),t}return e=u,n=[{key:"getName",value:function(){return"gamma"}}],(r=[{key:"getDefaultParameters",value:function(){return{gammaRed:1,gammaGreen:1,gammaBlue:1}}},{key:"before",value:function(t,e,r,n){var o,i={r:[],g:[],b:[]};for(o=0;o<256;o+=1)i.r[o]=255*Math.pow(o/255,1/t.gammaRed)+.5|0,i.g[o]=255*Math.pow(o/255,1/t.gammaGreen)+.5|0,i.b[o]=255*Math.pow(o/255,1/t.gammaBlue)+.5|0;return{table:i}}},{key:"callback",value:function(t,e,r,n,o,i){return{r:this.data.table.r[t.r],g:this.data.table.g[t.g],b:this.data.table.b[t.b],a:t.a}}}])&&At(e.prototype,r),n&&At(e,n),u}(k);function Wt(t,e,r){return{r:e.r+t*(r.r-e.r),g:e.g+t*(r.g-e.g),b:e.b+t*(r.b-e.b),a:e.a+t*(r.a-e.a)}}function Ft(t,e,r){var n=function(t,e,r){var n=t/255,o=e/255,i=r/255;return n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,o>.04045?o=Math.pow((o+.055)/1.055,2.4):o/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:.4124*(n*=100)+.3576*(o*=100)+.1805*(i*=100),y:.2126*n+.7152*o+.0722*i,z:.0193*n+.1192*o+.9505*i}}(t,e,r),o=n.x/95.047,i=n.y/100,a=n.z/108.883;return o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,{l:116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,a:500*(o-i),b:200*(i-(a=a>.008856?Math.pow(a,1/3):7.787*a+16/116))}}function Vt(t){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Kt(t,e){return(Kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Qt(t,e){if(e&&("object"===Vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zt(t){return(Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const $t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kt(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Zt(o);if(i){var r=Zt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qt(this,t)});function u(){return Ut(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"hsb-adjust"}}],(r=[{key:"getDefaultParameters",value:function(){return{h:1,s:1,b:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=function(t,e,r){var n,o,i=Math.max(t,e,r),a=Math.min(t,e,r);if(0==(o=0!==i?(i-a)/i:0))n=0;else{var u=(i-t)/(i-a),c=(i-e)/(i-a),f=(i-r)/(i-a);n=t===i?f-c:e===i?2+u-f:4+c-u,(n/=6)<0&&(n+=1)}return{h:n,s:o,b:i/255}}(t.r,t.g,t.b);for(a.h+=n.h;a.h<0;)a.h+=2*Math.PI;a.s+=n.s,a.s=Math.max(Math.min(a.s,1),0),a.b+=n.b,a.b=Math.max(Math.min(a.b,1),0);var u=function(t,e,r){var n,o,i;if(0===e)n=255*r+.5,o=255*r+.5,i=255*r+.5;else{var a=6*(t-Math.floor(t)),u=a-Math.floor(a),c=r*(1-e),f=r*(1-e*u),l=r*(1-e*(1-u));switch(0|a){case 0:n=255*r+.5,o=255*l+.5,i=255*c+.5;break;case 1:n=255*f+.5,o=255*r+.5,i=255*c+.5;break;case 2:n=255*c+.5,o=255*r+.5,i=255*l+.5;break;case 3:n=255*c+.5,o=255*f+.5,i=255*r+.5;break;case 4:n=255*l+.5,o=255*c+.5,i=255*r+.5;break;case 5:n=255*r+.5,o=255*c+.5,i=255*f+.5;break;default:n=0,o=0,i=0}}return{r:parseInt(n),g:parseInt(o),b:parseInt(i)}}(a.h,a.s,a.b);return t.r=u.r,t.g=u.g,t.b=u.b,t}}])&&Jt(e.prototype,r),n&&Jt(e,n),u}(k);function te(t){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ne(t,e){return(ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function oe(t,e){if(e&&("object"===te(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ie(t){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ne(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ie(o);if(i){var r=ie(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return oe(this,t)});function u(){return ee(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"invert-alpha"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return t.a=255-t.a,t}}])&&re(e.prototype,r),n&&re(e,n),u}(k);function ue(t){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function le(t,e){return(le=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function se(t,e){if(e&&("object"===ue(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ye(t){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&le(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ye(o);if(i){var r=ye(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return se(this,t)});function u(){return ce(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"invert"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t}}])&&fe(e.prototype,r),n&&fe(e,n),u}(k);function he(t){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function de(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ve(t,e){return(ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function me(t,e){if(e&&("object"===he(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ge(t)}function ge(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function we(t){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Oe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ve(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=we(o);if(i){var r=we(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return me(this,t)});function u(){var t;be(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Oe(ge(t=a.call.apply(a,[this].concat(r))),"data",{lut:[]}),t}return e=u,n=[{key:"getName",value:function(){return"levels"}}],(r=[{key:"getDefaultParameters",value:function(){return{low:0,high:1,lowOutput:0,highOutput:1}}},{key:"before",value:function(t,e,r,n){var o,i,a=new function(t,e,r,n,o){var i,a,u,c,f,l=new Array(3),s=new Array(4),y=new Array(4),p=new Array(3),h=new Array(3),b=new Array(3),d=e*r,v=!0;for(i=0;i<l.length;i+=1)for(l[i]=new Array(256),a=0;a<256;a+=1)l[i][a]=0;for(f=0;f<r;f+=1)for(c=0;c<e;c+=1)u=f*e*4+4*c,l[0][t.data[u]]++,l[1][t.data[u+1]]++,l[2][t.data[u+2]]++;for(i=0;i<256;i+=1)if(l[0][i]!==l[1][i]||l[1][i]!==l[2][i]){v=!1;break}for(i=0;i<3;i+=1){for(a=0;a<256;a+=1)if(l[i][a]>0){s[i]=a;break}for(a=255;a>=0;a-=1)if(l[i][a]>0){y[i]=a;break}for(p[i]=1/0,h[i]=0,a=0;a<256;a+=1)p[i]=Math.min(p[i],l[i][a]),h[i]=Math.max(h[i],l[i][a]),b[i]+=a*l[i][a];b[i]/=d,s[3]=Math.min(s[0],s[1],s[2]),y[3]=Math.max(y[0],y[1],y[2])}this.getNumSamples=function(){return d},this.isGray=function(){return v},this.getFrequency=function(t,e){return e?d<1||t<0||t>2||e<0||e>255?-1:l[t][e]:d>0&&v&&e>=0&&e<=255?l[0][e]:-1},this.getMinFrequency=function(t){return t?d<1||t<0||t>2?-1:p[t]:d>0&&v?p[0]:-1},this.getMaxFrequency=function(t){return t?d<1||t<0||t>2?-1:h[t]:d>0&&v?h[0]:-1},this.getMinValue=function(t){return t?s[t]:d>0&&v?s[0]:-1},this.getMaxValue=function(t){return t?y[t]:d>0&&v?y[0]:-1},this.getMeanValue=function(t){return t?b[t]:d>0&&v?b[0]:-1}}(n,e,r,0,e),u=new Array(3),c=255*t.low,f=255*t.high;for(o=0;o<u.length;o+=1)u[o]=new Array(256);for(c===f&&f++,o=0;o<3;o+=1)for(i=0;i<256;i+=1)u[o][i]=255*(t.lowOutput+(t.highOutput-t.lowOutput)*(i-c)/(f-c));return a.isGray(),{lut:u}}},{key:"callback",value:function(t,e,r,n,o,i){return{r:this.data.lut[0][t.r],g:this.data.lut[1][t.g],b:this.data.lut[2][t.b],a:t.a}}}])&&de(e.prototype,r),n&&de(e,n),u}(k);function je(t){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ke(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Se(t,e){return(Se=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Re(t,e){if(e&&("object"===je(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function xe(t){return(xe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Me=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Se(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=xe(o);if(i){var r=xe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Re(this,t)});function u(){return _e(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"rescale"}}],(r=[{key:"getDefaultParameters",value:function(){return{scale:1}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=n.scale*t.r,t.g=n.scale*t.g,t.b=n.scale*t.b,t}}])&&ke(e.prototype,r),n&&ke(e,n),u}(k);function Ee(t){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Be(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Te(t,e){return(Te=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ce(t,e){if(e&&("object"===Ee(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ie(t){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Te(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ie(o);if(i){var r=Ie(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ce(this,t)});function u(){return Be(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"solarize"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return{r:255*(t.r/255>.5?2*(t.r/255-.5):2*(.5-t.r/255)),g:255*(t.g/255>.5?2*(t.g/255-.5):2*(.5-t.g/255)),b:255*(t.b/255>.5?2*(t.b/255-.5):2*(.5-t.b/255)),a:t.a}}}])&&De(e.prototype,r),n&&De(e,n),u}(k);function Ye(t){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ge(t,e){return(Ge=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qe(t,e){if(e&&("object"===Ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Le(t){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const He=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ge(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Le(o);if(i){var r=Le(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return qe(this,t)});function u(){return Ae(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"threshold"}}],(r=[{key:"callback",value:function(t,e,r,n,o,i){return(t.r+t.g+t.b)/3>=127?{r:255,g:255,b:255,a:t.a}:{r:0,g:0,b:0,a:t.a}}}])&&Ne(e.prototype,r),n&&Ne(e,n),u}(k);function ze(t){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ve(t,e){return(Ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ue(t,e){if(e&&("object"===ze(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Je(t)}function Je(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ke(t){return(Ke=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ze=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ve(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ke(o);if(i){var r=Ke(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ue(this,t)});function u(){var t;We(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Qe(Je(t=a.call.apply(a,[this].concat(r))),"data",{lut:[]}),t}return e=u,n=[{key:"getName",value:function(){return"tritone"}}],(r=[{key:"getDefaultParameters",value:function(){return{shadowColor:{r:0,g:0,b:0,a:255},midColor:{r:136,g:136,b:136,a:255},highColor:{r:255,g:255,b:255,a:255}}}},{key:"before",value:function(t){var e,r,n=[];for(e=0;e<128;e+=1)r=e/127,n[e]=Wt(r,t.shadowColor,t.midColor);for(e=128;e<256;e+=1)r=(e-127)/128,n[e]=Wt(r,t.midColor,t.highColor);return{lut:n}}},{key:"callback",value:function(t,e,r,n,o,i){var a=Math.floor((t.r+t.g+t.b)/3);return this.data.lut[a]}}])&&Fe(e.prototype,r),n&&Fe(e,n),u}(k);function $e(t){return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rr(t,e){return(rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nr(t,e){if(e&&("object"===$e(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return or(t)}function or(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ir(t){return(ir=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ar(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const ur=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ir(o);if(i){var r=ir(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return nr(this,t)});function u(){var t;tr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ar(or(t=a.call.apply(a,[this].concat(r))),"data",{minDensity:0,maxDensity:0}),t}return e=u,n=[{key:"getName",value:function(){return"dissolve"}}],(r=[{key:"getDefaultParameters",value:function(){return{density:1,softness:0}}},{key:"before",value:function(t,e,r,n){var o=(1-t.density)*(1+t.softness);return{minDensity:o-t.softness,maxDensity:o}}},{key:"callback",value:function(t,e,r,n,o,i){var a=Math.random(),u=function(t,e,r){return r<t?0:r>=e?1:(r=(r-t)/(e-t))*r*(3-2*r)}(this.data.minDensity,this.data.maxDensity,a);return t.a=t.a*u,t}}])&&er(e.prototype,r),n&&er(e,n),u}(k);function cr(t){return(cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function sr(t,e){return(sr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yr(t,e){if(e&&("object"===cr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return pr(t)}function pr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hr(t){return(hr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function br(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const dr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&sr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hr(o);if(i){var r=hr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return yr(this,t)});function u(){var t;fr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return br(pr(t=a.call.apply(a,[this].concat(r))),"data",{hEdgeMatrix:[],vEdgeMatrix:[]}),t}return e=u,n=[{key:"getName",value:function(){return"edge"}}],(r=[{key:"getDefaultParameters",value:function(){return{matrixes:{robertsV:[0,0,-1,0,1,0,0,0,0],robertsH:[-1,0,0,0,1,0,0,0,0],prewittV:[-1,0,1,-1,0,1,-1,0,1],prewittH:[-1,-1,-1,0,0,0,1,1,1],sobelV:[-1,0,1,-2,0,2,-1,0,1],sobelH:[-1,-2,-1,0,0,0,1,2,1],freiChenV:[-1,0,1,-Math.sqrt(2),0,Math.sqrt(2),-1,0,1],freiChenH:[-1,-Math.sqrt(2),-1,0,0,0,1,Math.sqrt(2),1]},hEdgeMatrix:"sobelV",vEdgeMatrix:"sobelH"}}},{key:"before",value:function(t,e,r,n){var o,i,a=t.hEdgeMatrix,u=t.vEdgeMatrix;return"string"==typeof a&&(o=t.matrixes[t.hEdgeMatrix]),"string"==typeof u&&(i=t.matrixes[t.vEdgeMatrix]),{hEdgeMatrix:o,vEdgeMatrix:i}}},{key:"callback",value:function(t,e,r,n,o,i){var a,u,c,f,l,s,y,p,h=0,b=0,d=0,v=0,m=0,g=0,w=0,O=0,P=0;for(a=-1;a<=1;a+=1)for(0<=(u=r+a)&&u<i||(u=r),l=3*(a+1)+1,c=-1;c<=1;c+=1)0<=(f=e+c)&&f<o||(f=e),s=this.getOriginalPixel(f,u),y=this.data.hEdgeMatrix[l+c],p=this.data.vEdgeMatrix[l+c],h=s.r,b=s.g,d=s.b,v+=Math.floor(y*h),m+=Math.floor(y*b),g+=Math.floor(y*d),w+=Math.floor(p*h),O+=Math.floor(p*b),P+=Math.floor(p+d);return{r:h=Math.floor(Math.sqrt(v*v+w*w)/1.8),g:b=Math.floor(Math.sqrt(m*m+O*O)/1.8),b:d=Math.floor(Math.sqrt(g*g+P*P)/1.8),a:t.a}}}])&&lr(e.prototype,r),n&&lr(e,n),u}(k);function vr(t){return(vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wr(t,e){return(wr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Or(t,e){if(e&&("object"===vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Pr(t){return(Pr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const jr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pr(o);if(i){var r=Pr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Or(this,t)});function u(){return mr(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"channel-mix"}}],(r=[{key:"getDefaultParameters",value:function(){return{blueGreen:1,redBlue:1,greenRed:1,intoR:1,intoG:1,intoB:1}}},{key:"callback",value:function(t,e,r,n,o,i){var a=t.r,u=t.g,c=t.b;return{r:(n.intoR*(n.blueGreen*u+(255-n.blueGreen)*c)/255+(255-n.intoR)*a)/255,g:(n.intoG*(n.redBlue*u+(255-n.redBlue)*a)/255+(255-n.intoG)*u)/255,b:(n.intoB*(n.greenRed*u+(255-n.greenRed)*u)/255+(255-n.intoB)*c)/255,a:t.a}}}])&&gr(e.prototype,r),n&&gr(e,n),u}(k);function _r(t){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Sr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Rr(t,e){return(Rr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function xr(t,e){if(e&&("object"===_r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Mr(t)}function Mr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Er(t){return(Er=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Br(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Dr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Er(o);if(i){var r=Er(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xr(this,t)});function u(){var t;kr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Br(Mr(t=a.call.apply(a,[this].concat(r))),"data",{remap:function(t){return 0},min:0,max:0}),t}return e=u,n=[{key:"getName",value:function(){return"auto-contrast"}}],(r=[{key:"before",value:function(t,e,r){for(var n=1/0,o=-1,i=0;i<r;i+=1)for(var a=0;a<e;a+=1){var u=this.getPixel(a,i);n=Math.min((u.r+u.g+u.b)/3,n),o=Math.max((u.r+u.g+u.b)/3,o)}return{min:n,max:o,remap:function(t){return 255*(t-n)/(o-n)}}}},{key:"callback",value:function(t,e,r,n,o,i){return t.r=this.data.remap(t.r),t.g=this.data.remap(t.g),t.b=this.data.remap(t.b),t}}])&&Sr(e.prototype,r),n&&Sr(e,n),u}(k);function Tr(t){return(Tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Cr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ir(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Cr(Object(r),!0).forEach((function(e){Xr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Cr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Xr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ar(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nr(t,e){return(Nr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Gr(t,e){if(e&&("object"===Tr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function qr(t){return(qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Lr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nr(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=qr(n);if(o){var r=qr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gr(this,t)});function a(){return Yr(this,a),i.apply(this,arguments)}return e=a,(r=[{key:"callback",value:function(t,e,r,n,o){throw"Extend it."}},{key:"run",value:function(t,e){var r,n;e=Ir(Ir({},this.getDefaultParameters()),e);var o=function(t){return 0|Math.min(Math.max(t,0),255)},i={data:null},a=new Uint8ClampedArray(t.data);for(i.data=this.before.call(i,e,t.width,t.height,t),n=0;n<t.height;n+=1)for(r=0;r<t.width;r+=1){var u=this.callback.call(i,r,n,e,t.width,t.height),c=o(u[0]),f=o(u[1]),l=n*t.width*4+4*r,s=f*t.width*4+4*c;a[l+0]=t.data[s+0],a[l+1]=t.data[s+1],a[l+2]=t.data[s+2],a[l+3]=t.data[s+3]}return t.data.set(a),t}}])&&Ar(e.prototype,r),a}(b);function Hr(t){return(Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Wr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Fr(t,e){return(Fr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Vr(t,e){if(e&&("object"===Hr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ur(t)}function Ur(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jr(t){return(Jr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Kr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Qr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fr(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Jr(o);if(i){var r=Jr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Vr(this,t)});function u(){var t;zr(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Kr(Ur(t=a.call.apply(a,[this].concat(r))),"data",{sinTable:[],cosTable:[]}),t}return e=u,n=[{key:"getName",value:function(){return"diffuse"}}],(r=[{key:"getDefaultParameters",value:function(){return{scale:4}}},{key:"before",value:function(t,e,r,n){var o,i,a=new Array(256),u=new Array(256);for(o=0;o<256;o+=1)i=2*Math.PI*o/256,a[o]=t.scale*Math.sin(i),u[o]=t.scale*Math.cos(i);return{sinTable:a,cosTable:u}}},{key:"callback",value:function(t,e,r,n,o){var i=255*Math.random()|0,a=Math.random();return[t+a*this.data.sinTable[i],e+a*this.data.cosTable[i]]}}])&&Wr(e.prototype,r),n&&Wr(e,n),u}(Lr);function Zr(t){return(Zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function en(t,e){return(en=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function rn(t,e){if(e&&("object"===Zr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return nn(t)}function nn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function on(t){return(on=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function an(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const un=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&en(t,e)}(c,t);var e,r,n,o,i,u=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=on(o);if(i){var r=on(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return rn(this,t)});function c(){var t;$r(this,c);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return an(nn(t=u.call.apply(u,[this].concat(r))),"data",{icentreX:0,icentreY:0}),t}return e=c,n=[{key:"getName",value:function(){return"kaleidoscope"}}],(r=[{key:"getDefaultParameters",value:function(){return{centreX:.5,centreY:.5,angle:0,angle2:0,sides:3,radius:0}}},{key:"before",value:function(t,e,r,n){return{icentreX:e*t.centreX,icentreY:r*t.centreY}}},{key:"callback",value:function(t,e,r,n,o){var i=t-this.data.icentreX,u=e-this.data.icentreY,c=Math.sqrt(i*i+u*u),f=Math.atan2(u,i)-r.angle-r.angle2;if(f=a(f/Math.PI*r.sides*.5),0!==r.radius){var l=Math.cos(f),s=r.radius/l;c=s*a(c/s)}return f+=r.angle,[this.data.icentreX+c*Math.cos(f),this.data.icentreY+c*Math.sin(f)]}}])&&tn(e.prototype,r),n&&tn(e,n),c}(Lr);var cn={},fn=!1;const ln={init:function(){if(fn)return!1;fn=!0,cn.B=256,cn.BM=255,cn.N=4096,cn.P=new Array(cn.B+cn.B+2),cn.G1=new Array(cn.B+cn.B+2),cn.G2=new Array(cn.B+cn.B+2);for(var t=0;t<cn.G2.length;t+=1)cn.G2[t]=new Array(2);cn.G3=new Array(cn.B+cn.B+2);for(var e=0;e<cn.G3.length;e+=1)cn.G3[e]=new Array(3);var r,n,o;for(r=0;r<cn.B;r+=1){for(cn.P[r]=r,cn.G1[r]=(this.random()%(cn.B+cn.B)-cn.B)/cn.B,cn.G2[r]=[],n=0;n<2;n+=1)cn.G2[r][n]=(this.random()%(cn.B+cn.B)-cn.B)/cn.B;for(cn.G2[r]=this.normalize2(cn.G2[r]),cn.G3[r]=[],n=0;n<3;n+=1)cn.G3[r][n]=(this.random()%(cn.B+cn.B)-cn.B)/cn.B;cn.G3[r]=this.normalize3(cn.G3[r])}for(r=cn.B-1;r>=0;r-=1)o=cn.P[r],cn.P[r]=cn.P[n=this.random()%cn.B],cn.P[n]=o;for(r=0;r<cn.B+2;r+=1){for(cn.P[cn.B+r]=cn.P[r],cn.G1[cn.B+r]=cn.G1[r],n=0;n<2;n+=1)cn.G2[cn.B+r][n]=cn.G2[r][n];for(n=0;n<3;n++)cn.G3[cn.B+r][n]=cn.G3[r][n]}},random:function(){return 2147483647&(256*Math.random()*256|0)},normalize2:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return t[0]=t[0]/e,t[1]=t[1]/e,t[2]=t[2]/e,t},normalize3:function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return t[0]=t[0]/e,t[1]=t[1]/e,t},sCurve:function(t){return t*t*(3-2*t)},lerp:function(t,e,r){return e+t*(r-e)},noise1:function(t){var e,r,n,o,i,a,u,c;return this.init(),a=t+cn.N,r=1+(e=parseInt(a)&cn.BM)&cn.BM,o=(n=a-parseInt(a))-1,i=this.sCurve(n),u=n*cn.G1[cn.P[e]],c=o*cn.G1[cn.P[r]],2.3*this.lerp(i,u,c)},noise2:function(t,e){var r,n,o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j=[];return this.init(),m=t+cn.N,n=1+(r=parseInt(m)&cn.BM)&cn.BM,s=(l=m-parseInt(m))-1,m=e+cn.N,i=1+(o=parseInt(m)&cn.BM)&cn.BM,p=(y=m-parseInt(m))-1,O=cn.P[r],P=cn.P[n],a=cn.P[O+o],u=cn.P[P+o],c=cn.P[O+i],f=cn.P[P+i],h=this.sCurve(l),b=this.sCurve(y),g=l*(j=cn.G2[a])[0]+y*j[1],w=s*(j=cn.G2[u])[0]+y*j[1],d=this.lerp(h,g,w),g=l*(j=cn.G2[c])[0]+p*j[1],w=s*(j=cn.G2[f])[0]+p*j[1],v=this.lerp(h,g,w),1.5*this.lerp(b,d,v)},noise3:function(t,e,r){var n,o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j,_,k,S,R,x,M,E;return this.init(),S=t+cn.N,o=1+(n=parseInt(S)&cn.BM)&cn.BM,h=(p=S-parseInt(S))-1,S=e+cn.N,a=1+(i=parseInt(S)&cn.BM)&cn.BM,d=(b=S-parseInt(S))-1,S=r+cn.N,c=1+(u=parseInt(S)&cn.BM)&cn.BM,m=(v=S-parseInt(S))-1,M=cn.P[n],E=cn.P[o],f=cn.P[M+i],l=cn.P[E+i],s=cn.P[M+a],y=cn.P[E+a],S=this.sCurve(p),w=this.sCurve(b),O=this.sCurve(v),R=p*(g=cn.G3[f+u])[0]+b*g[1]+v*g[2],x=h*(g=cn.G3[l+u])[0]+b*g[1]+v*g[2],P=this.lerp(S,R,x),R=p*(g=cn.G3[s+u])[0]+d*g[1]+v*g[2],x=h*(g=cn.G3[y+u])[0]+d*g[1]+v*g[2],j=this.lerp(S,R,x),_=this.lerp(w,P,j),R=p*(g=cn.G3[f+c])[0]+b*g[1]+m*g[2],x=h*(g=cn.G3[l+c])[0]+b*g[1]+m*g[2],P=this.lerp(S,R,x),R=p*(g=cn.G3[s+c])[0]+d*g[1]+m*g[2],x=h*(g=cn.G3[y+c])[0]+d*g[1]+m*g[2],j=this.lerp(S,R,x),k=this.lerp(w,P,j),1.5*this.lerp(O,_,k)},turbulence3:function(t,e,r,n){var o,i=0;for(o=1;o<=n;o*=2)i+=Math.abs(this.noise3(o*t,o*e,o*r))/o;return i}};function sn(t){return(sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function hn(t,e){return(hn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function bn(t,e){if(e&&("object"===sn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return dn(t)}function dn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vn(t){return(vn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const gn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&hn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vn(o);if(i){var r=vn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return bn(this,t)});function u(){var t;yn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return mn(dn(t=a.call.apply(a,[this].concat(r))),"data",{sinTable:[],cosTable:[],displacementMap:function(t,e){return 0}}),t}return e=u,n=[{key:"getName",value:function(){return"marble"}}],(r=[{key:"getDefaultParameters",value:function(){return{xScale:4,yScale:4,amount:1,turbulence:1}}},{key:"before",value:function(t,e,r,n){for(var o,i=new Array(256),a=new Array(256),u=0;u<256;u+=1)o=2*Math.PI*u/256*t.turbulence,i[u]=-t.yScale*Math.sin(o),a[u]=t.yScale*Math.cos(o);return{sinTable:i,cosTable:a,displacementMap:function(e,r){var n=127*(1+ln.noise2(e/t.xScale,r/t.yScale));return Math.min(255,Math.max(0,n))}}}},{key:"callback",value:function(t,e,r,n,o){var i=Math.floor(this.data.displacementMap(t,e));return[t+this.data.sinTable[i],e+this.data.cosTable[i]]}}])&&pn(e.prototype,r),n&&pn(e,n),u}(Lr);function wn(t){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function On(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function jn(t,e){return(jn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _n(t,e){if(e&&("object"===wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return kn(t)}function kn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Sn(t){return(Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const xn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Sn(o);if(i){var r=Sn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _n(this,t)});function u(){var t;On(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Rn(kn(t=a.call.apply(a,[this].concat(r))),"data",{icentreX:0,icentreY:0,radius2:0,radius:0}),t}return e=u,n=[{key:"getName",value:function(){return"pinch"}}],(r=[{key:"getDefaultParameters",value:function(){return{angle:0,centreX:.5,centreY:.5,radius:100,amount:.5}}},{key:"before",value:function(t,e,r,n){var o=e*t.centreX,i=r*t.centreY,a=t.radius;return 0===a&&(a=Math.min(o,i)),{icentreX:o,icentreY:i,radius:a,radius2:a*a}}},{key:"callback",value:function(t,e,r,n,o){var i,a,u,c,f,l,s=t-this.data.icentreX,y=e-this.data.icentreY,p=s*s+y*y;return p>this.data.radius2||0===p?[t,e]:(i=Math.sqrt(p/this.data.radius2),s*=a=Math.pow(Math.sin(.5*Math.PI*i),-r.amount),y*=a,u=1-i,c=r.angle*u*u,f=Math.sin(c),l=Math.cos(c),[this.data.icentreX+l*s-f*y,this.data.icentreY+f*s+l*y])}}])&&Pn(e.prototype,r),n&&Pn(e,n),u}(Lr);function Mn(t){return(Mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function En(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Bn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dn(t,e){return(Dn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Tn(t,e){if(e&&("object"===Mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Cn(t){return(Cn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const In=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Dn(t,e)}(f,t);var e,r,n,o,u,c=(o=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Cn(o);if(u){var r=Cn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Tn(this,t)});function f(){return En(this,f),c.apply(this,arguments)}return e=f,n=[{key:"getName",value:function(){return"ripple"}}],(r=[{key:"getDefaultParameters",value:function(){return{xAmplitude:5,yAmplitute:0,xWaveLength:16,yWaveLength:16,waveType:"SINE"}}},{key:"callback",value:function(t,e,r,n,o){var u,c,f=e/r.xWaveLength,l=t/r.yWaveLength;switch(r.waveType){case"SINE":default:u=Math.sin(f),c=Math.sin(l);break;case"SAWTOOTH":u=i(f,1),c=i(l,1);break;case"TRIANGLE":u=a(f),c=a(l);break;case"NOISE":u=ln.noise1(f),c=ln.noise1(l)}return[t+r.xAmplitude*u,e+r.yAmplitute*c]}}])&&Bn(e.prototype,r),n&&Bn(e,n),f}(Lr);function Xn(t){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function An(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nn(t,e){return(Nn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Gn(t,e){if(e&&("object"===Xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return qn(t)}function qn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ln(t){return(Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Hn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const zn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nn(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ln(o);if(i){var r=Ln(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gn(this,t)});function u(){var t;Yn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Hn(qn(t=a.call.apply(a,[this].concat(r))),"data",{shx:0,shy:0}),t}return e=u,n=[{key:"getName",value:function(){return"shear"}}],(r=[{key:"getDefaultParameters",value:function(){return{xAngle:0,yAngle:0,xOffset:0,yOffset:0}}},{key:"before",value:function(t,e,r){return{shx:Math.sin(t.xAngle),shy:Math.sin(t.yAngle)}}},{key:"callback",value:function(t,e,r,n,o){return[t+r.xOffset+e*this.data.shx,e+r.yOffset+t*this.data.shy]}}])&&An(e.prototype,r),n&&An(e,n),u}(Lr);function Wn(t){return(Wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Un(t,e){return(Un=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Jn(t,e){if(e&&("object"===Wn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kn(t)}function Kn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qn(t){return(Qn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zn(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const $n=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Un(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qn(o);if(i){var r=Qn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Jn(this,t)});function u(){var t;Fn(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Zn(Kn(t=a.call.apply(a,[this].concat(r))),"data",{icentreX:0,icentreY:0,a2:0,b2:0,a:0,b:0}),t}return e=u,n=[{key:"getName",value:function(){return"sphere"}}],(r=[{key:"getDefaultParameters",value:function(){return{a:0,b:0,centreX:.5,centreY:.5,refractionIndex:1.5}}},{key:"before",value:function(t,e,r){var n=e*t.centreX,o=r*t.centreY,i=t.a,a=t.b;return 0===i&&(i=e/2),0===a&&(a=r/2),{icentreX:n,icentreY:o,a:i,b:a,a2:i*i,b2:a*a}}},{key:"callback",value:function(t,e,r,n,o){var i=t-this.data.icentreX,a=e-this.data.icentreY,u=i*i,c=a*a,f=1/r.refractionIndex,l=Math.sqrt((1-u/this.data.a2-c/this.data.b2)*(this.data.a*this.data.b)),s=l*l,y=Math.acos(i/Math.sqrt(u+s)),p=Math.PI/2-y,h=Math.asin(Math.sin(p)*f),b=Math.acos(a/Math.sqrt(c+s)),d=new Array(2);return c>=this.data.b2-this.data.b2/u/this.data.a2?[t,e]:(h=Math.PI/2-y-h,d[0]=t-Math.tan(h)*l,p=Math.PI/2-b,h=Math.asin(Math.sin(p)*f),h=Math.PI/2-b-h,d[1]=e-Math.tan(h)*l,d)}}])&&Vn(e.prototype,r),n&&Vn(e,n),u}(Lr);function to(t){return(to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ro(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function no(t,e){return(no=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function oo(t,e){if(e&&("object"===to(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return io(t)}function io(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ao(t){return(ao=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const co=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&no(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ao(o);if(i){var r=ao(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return oo(this,t)});function u(){var t;eo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return uo(io(t=a.call.apply(a,[this].concat(r))),"data",{m00:0,m01:0,m10:0,m11:0}),t}return e=u,n=[{key:"getName",value:function(){return"swim"}}],(r=[{key:"getDefaultParameters",value:function(){return{scale:32,turbulence:0,amount:1,time:0,angle:0,stretch:1}}},{key:"before",value:function(t,e,r){var n=Math.cos(t.angle),o=Math.sin(t.angle);return{m00:n,m01:o,m10:-o,m11:n}}},{key:"callback",value:function(t,e,r,n,o){var i=this.data.m00*t+this.data.m01*e,a=this.data.m10*t+this.data.m11*e;return i/=r.scale,a/=r.scale*r.stretch,1===r.turbulence?[t+r.amount*ln.noise3(i+.5,a,r.time),e+r.amount*ln.noise3(i,a+.5,r.time)]:[t+r.amount*ln.turbulence3(i+.5,a,r.turbulence,r.time),e+r.amount*ln.turbulence3(i,a+.5,r.turbulence,r.time)]}}])&&ro(e.prototype,r),n&&ro(e,n),u}(Lr);function fo(t){return(fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function so(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yo(t,e){return(yo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function po(t,e){if(e&&("object"===fo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ho(t)}function ho(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bo(t){return(bo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const mo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yo(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bo(o);if(i){var r=bo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return po(this,t)});function u(){var t;lo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return vo(ho(t=a.call.apply(a,[this].concat(r))),"data",{iCentreX:0,iCentreY:0,radius:0,radius2:0}),t}return e=u,n=[{key:"getName",value:function(){return"twirl"}}],(r=[{key:"getDefaultParameters",value:function(){return{angle:0,centreX:.5,centreY:.5,radius:100,radius2:100}}},{key:"before",value:function(t,e,r){var n=e*t.centreX,o=r*t.centreY,i=t.radius;return 0===i&&(i=Math.min(n,o)),{iCentreX:n,iCentreY:o,radius:i,radius2:i*i}}},{key:"callback",value:function(t,e,r,n,o){var i,a=t-this.data.iCentreX,u=e-this.data.iCentreY,c=a*a+u*u;return c>r.radius2?[t,e]:(c=Math.sqrt(c),i=Math.atan2(u,a)+r.angle*(r.radius-c)/r.radius,[this.data.iCentreX+c*Math.cos(i),this.data.iCentreY+c*Math.sin(i)])}}])&&so(e.prototype,r),n&&so(e,n),u}(Lr);function go(t){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Oo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Po(t,e){return(Po=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jo(t,e){if(e&&("object"===go(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _o(t)}function _o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ko(t){return(ko=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function So(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ro=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Po(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ko(o);if(i){var r=ko(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return jo(this,t)});function u(){var t;wo(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return So(_o(t=a.call.apply(a,[this].concat(r))),"data",{iCentreX:0,iCentreY:0,radius2:0,radius:0}),t}return e=u,n=[{key:"getName",value:function(){return"water"}}],(r=[{key:"getDefaultParameters",value:function(){return{waveLength:16,amplitude:10,phase:0,centreX:.5,centreY:.5,radius:50}}},{key:"before",value:function(t,e,r){var n=e*t.centreX,o=r*t.centreY,i=t.radius;return 0===i&&(i=Math.min(n,o)),{iCentreX:n,iCentreY:o,radius:i,radius2:i*i}}},{key:"callback",value:function(t,e,r,n,o){var i,a,u=t-this.data.iCentreX,c=e-this.data.iCentreY,f=u*u+c*c;return f>this.data.radius2?[t,e]:(i=Math.sqrt(f),a=r.amplitude*Math.sin(i/r.waveLength*Math.PI*2-r.phase),a*=(r.radius-i)/r.radius,0!==i&&(a*=r.waveLength/i),[t+u*a,e+c*a])}}])&&Oo(e.prototype,r),n&&Oo(e,n),u}(Lr);function xo(t){return(xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Bo(t,e){return(Bo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Do(t,e){if(e&&("object"===xo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return To(t)}function To(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Co(t){return(Co=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Io(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Xo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bo(t,e)}(c,t);var e,r,n,o,a,u=(o=c,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Co(o);if(a){var r=Co(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Do(this,t)});function c(){var t;Mo(this,c);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return Io(To(t=u.call.apply(u,[this].concat(r))),"data",{icentreX:0,icentreY:0,width:0}),t}return e=c,n=[{key:"getName",value:function(){return"circle"}}],(r=[{key:"getDefaultParameters",value:function(){return{radius:10,height:20,angle:0,spreadAngle:Math.PI,centreX:.5,centreY:.5}}},{key:"before",value:function(t,e,r,n){return{icentreX:e*t.centreX,icentreY:r*t.centreY,width:--e}}},{key:"callback",value:function(t,e,r,n,o){var a=t-this.data.icentreX,u=e-this.data.icentreX,c=Math.atan2(-u,-a)+r.angle,f=Math.sqrt(a*a+u*u);return c=i(c,2*Math.PI),[this.data.width*c/r.spreadAngle+1e-5,o*(1-(f-r.radius)/(o+1e-5))]}}])&&Eo(e.prototype,r),n&&Eo(e,n),c}(Lr);function Yo(t){return(Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ao(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function No(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Go(t,e){return(Go=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qo(t,e){if(e&&("object"===Yo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Lo(t)}function Lo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ho(t){return(Ho=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zo(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Wo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Go(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ho(o);if(i){var r=Ho(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return qo(this,t)});function u(){var t;Ao(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return zo(Lo(t=a.call.apply(a,[this].concat(r))),"data",{sin:0,cos:0,icentreX:0,icentreY:0}),t}return e=u,n=[{key:"getName",value:function(){return"rotate"}}],(r=[{key:"getDefaultParameters",value:function(){return{angle:Math.PI}}},{key:"before",value:function(t,e,r,n){return{cos:Math.cos(t.angle),sin:Math.sin(t.angle),icentreX:e/2,icentreY:r/2}}},{key:"callback",value:function(t,e,r,n,o){return[this.data.cos*(t-this.data.icentreX)-this.data.sin*(e-this.data.icentreY)+this.data.icentreY,this.data.sin*(t-this.data.icentreX)-this.data.cos*(e-this.data.icentreY)+this.data.icentreY]}}])&&No(e.prototype,r),n&&No(e,n),u}(Lr);function Fo(t){return(Fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Uo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Jo(t,e){return(Jo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ko(t,e){if(e&&("object"===Fo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Qo(t){return(Qo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Zo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jo(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qo(o);if(i){var r=Qo(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ko(this,t)});function u(){return Vo(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"offset"}}],(r=[{key:"getDefaultParameters",value:function(){return{xOffset:100,yOffset:100,wrap:!0}}},{key:"callback",value:function(t,e,r,n,o){return r.wrap?[(t+n-r.xOffset)%n,(e+o-r.yOffset)%o]:[t-r.xOffset,e-r.yOffset]}}])&&Uo(e.prototype,r),n&&Uo(e,n),u}(Lr);function $o(t){return($o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ti(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ei(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ri(t,e){return(ri=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ni(t,e){if(e&&("object"===$o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return oi(t)}function oi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ii(t){return(ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ai(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const ui=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ri(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ii(o);if(i){var r=ii(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ni(this,t)});function u(){var t;ti(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ai(oi(t=a.call.apply(a,[this].concat(r))),"data",{centreX:0,centreY:0,sqr:function(t){return 0},radius:0}),t}return e=u,n=[{key:"getName",value:function(){return"polar"}}],(r=[{key:"getDefaultParameters",value:function(){return{type:"RECT_TO_POLAR"}}},{key:"before",value:function(t,e,r,n){return{centreX:e/2,centreY:r/2,radius:Math.max(e/2,r/2),sqr:function(t){return t*t}}}},{key:"callback",value:function(t,e,r,n,o){var i,a,u,c,f,l,s,y,p=0;switch(r.type){case"RECT_TO_POLAR":return t>=this.data.centreX?e>this.data.centreY?(i=Math.PI-Math.atan((t-this.data.centreX)/(e-this.data.centreY)),p=Math.sqrt(this.data.sqr(t-this.data.centreX)+this.data.sqr(e-this.data.centreY))):e<this.data.centreY?(i=Math.atan((t-this.data.centreX)/(this.data.centreY-e)),p=Math.sqrt(this.data.sqr(t-this.data.centreX)+this.data.sqr(this.data.centreY-e))):(i=Math.PI/2,p=t-this.data.centreX):t<this.data.centreX&&(e<this.data.centreY?(i=2*Math.PI-Math.atan((this.data.centreX-t)/(this.data.centreY-e)),p=Math.sqrt(this.data.sqr(this.data.centreX-t)+this.data.sqr(this.data.centreY-e))):e>this.data.centreY?(i=Math.PI+Math.atan((this.data.centreX-t)/(e-this.data.centreY)),p=Math.sqrt(this.data.sqr(this.data.centreX-t)+this.data.sqr(e-this.data.centreY))):(i=1.5*Math.PI,p=this.data.centreX-t)),(t!=this.data.centreX?Math.abs((e-this.data.centreY)/(t-this.data.centreX)):0)<=o/n?t==this.data.centreX?this.data.centreY:this.data.centreX:this.data.centreY,[n-1-(n-1)/(2*Math.PI*i),o*p/this.data.radius];case"POLAR_TO_RECT":return a=(i=t/n*Math.PI*2)>=1.5*Math.PI?2*Math.PI-i:i>=Math.PI?i-Math.PI:i>=.5*Math.PI?Math.PI-i:i,(0!=(u=Math.tan(a))?1/u:0)<=o/n?0==a?this.data.centreY:this.data.centreX:this.data.centreY,c=-(p=this.data.radius*(e/o))*Math.sin(a),f=p*Math.cos(a),i>=1.5*Math.PI?[this.data.centreX-c,this.data.centreY-f]:i>=Math.PI?[this.data.centreX-c,this.data.centreY+f]:i>=.5*Math.PI?[this.data.centreX+c,this.data.centreY+f]:[this.data.centreX+c,this.data.centreY-f];case"INVERT_IN_CIRCLE":return y=(l=t-this.data.centreX)*l+(s=e-this.data.centreY)*s,[this.data.centreX+this.data.centreX*this.data.centreX*l/y,this.data.centreY+this.data.centreY*this.data.centreY*s/y]}}}])&&ei(e.prototype,r),n&&ei(e,n),u}(Lr);function ci(t){return(ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function li(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function si(t,e){return(si=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yi(t,e){if(e&&("object"===ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return pi(t)}function pi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hi(t){return(hi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const di=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&si(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hi(o);if(i){var r=hi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return yi(this,t)});function u(){var t;fi(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return bi(pi(t=a.call.apply(a,[this].concat(r))),"data",{A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0}),t}return e=u,n=[{key:"getName",value:function(){return"perspective"}}],(r=[{key:"getDefaultParameters",value:function(){return{x0:0,y0:0,x1:1,y1:0,x2:1,y2:1,x3:0,y3:1}}},{key:"before",value:function(t,e,r,n){var o=function(){var n={a11:0,a21:0,a31:0,a12:0,a22:0,a32:0,a13:0,a23:0,a33:0,A:0,B:0,C:0,D:0,E:0,F:0,G:0,H:0,I:0},o=Math.floor(e*t.x0),i=Math.floor(r*t.y0),a=Math.floor(e*t.x1),u=Math.floor(r*t.y1),c=Math.floor(e*t.x2),f=Math.floor(r*t.y2),l=Math.floor(e*t.x3),s=Math.floor(r*t.y3),y=a-c,p=u-f,h=l-c,b=s-f,d=o-a+c-l,v=i-u+f-s;return 0==d&&0==v?(n.a11=a-o,n.a21=c-a,n.a31=o,n.a12=u-i,n.a22=f-u,n.a32=i,n.a13=n.a23=0):(n.a13=(d*b-h*v)/(y*b-p*h),n.a23=(y*v-p*d)/(y*b-p*h),n.a11=a-o+n.a13*a,n.a21=l-o+n.a23*l,n.a31=o,n.a12=u-i+n.a13*u,n.a22=s-i+n.a23*s,n.a32=i),n.a33=1,n}();return o.A=o.a22*o.a33-o.a32*o.a23,o.B=o.a31*o.a23-o.a21*o.a33,o.C=o.a21*o.a32-o.a31*o.a22,o.D=o.a32*o.a13-o.a12*o.a33,o.E=o.a11*o.a33-o.a31*o.a13,o.F=o.a31*o.a12-o.a11*o.a32,o.G=o.a12*o.a23-o.a22*o.a13,o.H=o.a21*o.a13-o.a11*o.a23,o.I=o.a11*o.a22-o.a21*o.a12,o}},{key:"callback",value:function(t,e,r,n,o){return[n*(this.data.A*t+this.data.B*e+this.data.C)/(this.data.G*t+this.data.H*e+this.data.I),o*(this.data.D*t+this.data.E*e+this.data.F)/(this.data.G*t+this.data.H*e+this.data.I)]}}])&&li(e.prototype,r),n&&li(e,n),u}(Lr);function vi(t){return(vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function gi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?mi(Object(r),!0).forEach((function(e){wi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function wi(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ji(t,e){return(ji=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _i(t,e){if(e&&("object"===vi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ki(t){return(ki=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Si=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ji(t,e)}(a,t);var e,r,n,o,i=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ki(n);if(o){var r=ki(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _i(this,t)});function a(){return Oi(this,a),i.apply(this,arguments)}return e=a,(r=[{key:"callback",value:function(t,e,r){throw"Extend it."}},{key:"run",value:function(t,e){e=gi(gi({},this.getDefaultParameters()),e);var r=new Uint8ClampedArray(t.data),n=function(e,r){return r*t.width*4+4*e},o=function(t){return 0|Math.min(Math.max(t,0),255)},i={getPixel:function(t,e){var o=n(t,e);return{r:r[o+0],g:r[o+1],b:r[o+2],a:r[o+3]}},getOriginalPixelByIndex:function(e){return e*=4,{r:t.data[e],g:t.data[e+1],b:t.data[e+2],a:t.data[e+3]}},getOriginalPixel:function(e,r){var o=n(e,r);return{r:t.data[o+0],g:t.data[o+1],b:t.data[o+2],a:t.data[o+3]}},setPixel:function(t,e,i){var a=n(t,e);r[a+0]=o(i.r),r[a+1]=o(i.g),r[a+2]=o(i.b),r[a+3]=o(i.a)},setPixelByIndex:function(t,e){r[0+(t*=4)]=o(e.r),r[t+1]=o(e.g),r[t+2]=o(e.b),r[t+3]=o(e.a)},data:null,width:t.width,height:t.height};return i.data=this.before.call(i,e,t.width,t.height,t),this.callback.call(i,t.width,t.height,e),t.data.set(r),t}}])&&Pi(e.prototype,r),a}(b);function Ri(t){return(Ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Mi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ei(t,e){return(Ei=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Bi(t,e){if(e&&("object"===Ri(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Di(t){return(Di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Ti=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ei(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Di(o);if(i){var r=Di(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Bi(this,t)});function u(){return xi(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"auto-white-balance"}}],(r=[{key:"getDefaultParameters",value:function(){return{intensity:50}}},{key:"callback",value:function(t,e,r){var n,o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w=0,O=0;for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)w+=(a=Ft((i=this.getPixel(n,o)).r,i.g,i.b)).a,O+=a.b;for(u=0-O/(t*e),c=(0-w/(t*e))*(r.intensity/100)*1.1,f=u*(r.intensity/100)*1.1,o=0;o<e;o+=1)for(n=0;n<t;n+=1)(a=Ft((i=this.getPixel(n,o)).r,i.g,i.b)).a+=c,a.b+=f,(l=a.l,s=a.a,y=a.b,p=void 0,h=void 0,b=void 0,d=void 0,v=void 0,m=void 0,g=void 0,p=function(t,e,r){var n=(t+16)/116,o=e/500+n,i=n-r/200;return n=Math.pow(n,3)>.008856?Math.pow(n,3):(n-16/116)/7.787,{x:95.047*(o=Math.pow(o,3)>.008856?Math.pow(o,3):(o-16/116)/7.787),y:100*n,z:108.883*(i=Math.pow(i,3)>.008856?Math.pow(i,3):(i-16/116)/7.787)}}(l,s,y),h=p.x/100,b=p.y/100,d=p.z/100,v=3.2406*h+-1.5372*b+-.4986*d,m=-.9689*h+1.8758*b+.0415*d,g=.0557*h+-.204*b+1.057*d,v>.0031308?v=1.055*Math.pow(v,1/2.4)-.055:v*=12.92,m>.0031308?m=1.055*Math.pow(m,1/2.4)-.055:m*=12.92,g>.0031308?g=1.055*Math.pow(g,1/2.4)-.055:g*=12.92,i={r:255*v,g:255*m,b:255*g}).a=this.getPixel(n,o).a,this.setPixel(n,o,i)}}])&&Mi(e.prototype,r),n&&Mi(e,n),u}(Si);function Ci(t){return(Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ii(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yi(t,e){return(Yi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ai(t,e){if(e&&("object"===Ci(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ni(t){return(Ni=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Gi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Yi(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ni(o);if(i){var r=Ni(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ai(this,t)});function u(){return Ii(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"fill-color"}}],(r=[{key:"getDefaultParameters",value:function(){return{color:"transparent"}}},{key:"callback",value:function(t,e,r){var n,o,i,a,u;for("transparent"===r.color?i={r:0,g:0,b:0,a:0}:(a=r.color,(i={r:(u=parseInt(a.replace("#",""),16))>>16,g:u>>8&255,b:255&u}).a=255),o=0;o<e;o+=1)for(n=0;n<t;n+=1)this.setPixel(n,o,i)}}])&&Xi(e.prototype,r),n&&Xi(e,n),u}(Si);function qi(t){return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Li(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Hi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zi(t,e){return(zi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wi(t,e){if(e&&("object"===qi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fi(t){return(Fi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const Vi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zi(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Fi(o);if(i){var r=Fi(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Wi(this,t)});function u(){return Li(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"flip"}}],(r=[{key:"getDefaultParameters",value:function(){return{operation:"FLIP_H"}}},{key:"callback",value:function(t,e,r){var n,o,i=0,a=0,u=t,c=e;for(r.operation,a=0;a<e;a+=1)for(i=0;i<t;i+=1){switch(n=a,o=i,r.operation){case"FLIP_H":o=u-i-1;break;case"FLIP_V":n=c-a-1;break;case"FLIP_HV":n=i,o=a;break;case"FLIP_90CW":n=i,o=c-a-1;break;case"FLIP_90CCW":n=u-i-1,o=a;break;case"FLIP_180":n=c-a-1,o=u-i-1}this.setPixel(o,n,this.getOriginalPixel(i,a))}}}])&&Hi(e.prototype,r),n&&Hi(e,n),u}(Si);function Ui(t){return(Ui="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ji(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ki(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qi(t,e){return(Qi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Zi(t,e){if(e&&("object"===Ui(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $i(t){return($i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const ta=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Qi(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$i(o);if(i){var r=$i(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Zi(this,t)});function u(){return Ji(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"block"}}],(r=[{key:"getDefaultParameters",value:function(){return{blockSize:5}}},{key:"callback",value:function(t,e,r){var n,o,i,a,u,c,f,l,s,y,p;for(o=0;o<e;o+=r.blockSize)for(n=0;n<t;n+=r.blockSize){for(u=(i=Math.min(r.blockSize,t-n))*(a=Math.min(r.blockSize,e-o)),c=0,f=0,l=0,y=0;y<a;y+=1)for(p=0;p<i;p+=1)c+=255&(s=this.getOriginalPixel(n+p,o+y)).r,f+=255&s.g,l+=255&s.b;for(c/=u,f/=u,l/=u,y=0;y<a;y+=1)for(p=0;p<i;p+=1)this.setPixel(n+p,o+y,{r:c,g:f,b:l,a:255})}}}])&&Ki(e.prototype,r),n&&Ki(e,n),u}(Si);function ea(t){return(ea="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ra(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function na(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function oa(t,e){return(oa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ia(t,e){if(e&&("object"===ea(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return aa(t)}function aa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ua(t){return(ua=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ca(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const fa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oa(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ua(o);if(i){var r=ua(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ia(this,t)});function u(){var t;ra(this,u);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return ca(aa(t=a.call.apply(a,[this].concat(r))),"data",{leftBorder:0,rightBorder:0,topBorder:0,bottomBorder:0}),t}return e=u,n=[{key:"getName",value:function(){return"border"}}],(r=[{key:"getDefaultParameters",value:function(){return{leftBorder:10,rightBorder:10,topBorder:10,bottomBorder:10,borderColor:{r:0,b:0,g:0,a:255}}}},{key:"before",value:function(t,e,r,n){return{leftBorder:0|t.leftBorder,rightBorder:0|t.rightBorder,topBorder:0|t.rightBorder,bottomBorder:0|t.bottomBorder}}},{key:"callback",value:function(t,e,r){var n,o;for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)this.data.leftBorder>0&&n<this.data.leftBorder&&this.setPixel(n,o,r.borderColor),this.data.rightBorder>0&&t-this.data.rightBorder<n&&this.setPixel(n,o,r.borderColor),this.data.topBorder>0&&o<this.data.topBorder&&this.setPixel(n,o,r.borderColor),this.data.bottomBorder>0&&e-this.data.bottomBorder<o&&this.setPixel(n,o,r.borderColor)}}])&&na(e.prototype,r),n&&na(e,n),u}(Si);function la(t){return(la="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sa(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ya(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pa(t,e){return(pa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ha(t,e){if(e&&("object"===la(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ba(t){return(ba=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const da=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pa(t,e)}(c,t);var e,r,n,o,i,a=(o=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ba(o);if(i){var r=ba(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ha(this,t)});function c(){return sa(this,c),a.apply(this,arguments)}return e=c,n=[{key:"getName",value:function(){return"emboss"}}],(r=[{key:"getDefaultParameters",value:function(){return{azimuth:135*Math.PI/180,elevation:30*Math.PI/180,width45:3,emboss:!0}}},{key:"callback",value:function(t,e,r){var n,o,i,a,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j,_=t,k=[],S=255.9,R=0,x=0;for(f=Math.cos(r.azimuth)*Math.cos(r.elevation)*S|0,l=Math.sin(r.azimuth)*Math.cos(r.elevation)*S|0,s=Math.sin(r.elevation)*S|0,y=(c=1530/r.width45|0)*c,p=c*s,g=s,o=0;o<e;o+=1)for(n=0;n<t;n+=1)k.push(0|u(this.getOriginalPixel(n,o)));for(o=0;o<e;o+=1,R+=_)for(v=(d=(b=R)+_)+_,n=0;n<t;n+=1,b+=1,d+=1,v+=1)0!=o&&o<e-2&&0!=n&&n<t-2?(i=k[b-1]+k[d-1]+k[v-1]-k[b+1]-k[d+1]-k[v+1],a=k[v-1]+k[v]+k[v+1]-k[b-1]-k[b]-k[b+1],m=0==i&&0==a?g:(h=i*f+a*l+p)<0?0:h/Math.sqrt(i*i+a*a+y)):m=g,r.emboss?(O=(w=this.getOriginalPixelByIndex(x)).r*m>>8,P=w.g*m>>8,j=w.b*m>>8,this.setPixelByIndex(x++,{r:O,g:P,b:j,a:w.a})):this.setPixelByIndex(x++,{r:m,g:m<<8,b:m<<16,a:255})}}])&&ya(e.prototype,r),n&&ya(e,n),c}(Si);function va(t){return(va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ma(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ga(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wa(t,e){return(wa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Oa(t,e){if(e&&("object"===va(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Pa(t){return(Pa=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}const ja=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wa(t,e)}(u,t);var e,r,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Pa(o);if(i){var r=Pa(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Oa(this,t)});function u(){return ma(this,u),a.apply(this,arguments)}return e=u,n=[{key:"getName",value:function(){return"component-stretching"}}],(r=[{key:"callback",value:function(t,e,r){var n,o,i,a=1/0,u=1/0,c=1/0,f=-1,l=-1,s=-1,y=function(t,e,r){return 255*(t-e)/(r-e)};for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)i=this.getPixel(n,o),a=Math.min(i.r,a),u=Math.min(i.g,u),c=Math.min(i.b,c),f=Math.max(i.r,f),l=Math.max(i.g,l),s=Math.max(i.b,s);for(o=0;o<e;o+=1)for(n=0;n<t;n+=1)(i=this.getPixel(n,o)).r=y(i.r,a,f),i.g=y(i.g,u,l),i.b=y(i.b,c,s),this.setPixel(n,o,i)}}])&&ga(e.prototype,r),n&&ga(e,n),u}(Si);function _a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ka={};function Sa(t){if(ka[t.getName()])throw"Effect: ".concat(t.getName()," exists already!");ka[t.getName()]=t}Sa(D),Sa(N),Sa(U),Sa(nt),Sa(yt),Sa(Ot),Sa(xt),Sa(It),Sa(zt),Sa($t),Sa(ae),Sa(pe),Sa(Pe),Sa(Me),Sa(Xe),Sa(He),Sa(Ze),Sa(Qr),Sa(ur),Sa(un),Sa(gn),Sa(xn),Sa(In),Sa(zn),Sa($n),Sa(co),Sa(mo),Sa(Ro),Sa(dr),Sa(jr),Sa(Xo),Sa(Wo),Sa(Zo),Sa(ui),Sa(di),Sa(Dr),Sa(Ti),Sa(Gi),Sa(Vi),Sa(ta),Sa(fa),Sa(da),Sa(ja);const Ra=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"get",value:function(t){return ka[t]}}],null&&_a(e.prototype,null),r&&_a(e,r),t}();function xa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ma(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ea=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ma(this,"obj",null),Ma(this,"layer",null),Ma(this,"x",0),Ma(this,"y",0),Ma(this,"opts",{}),Ma(this,"effects",[]),this.obj=e,this.layer=r,this.x=n,this.y=o,this.opts=i}var e,r;return e=t,(r=[{key:"getObject",value:function(){return this.obj}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.obj.getWidth()}},{key:"getHeight",value:function(){return this.obj.getHeight()}},{key:"exportObject",value:function(){for(var t=this.obj.getImageData(),e=0;e<this.effects.length;e+=1)t=this.effects[e].effect.run(t,this.effects[e].parameters);return t}},{key:"applyEffect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.effects.push({name:t,effect:new(Ra.get(t)),parameters:e}),this}},{key:"moveXY",value:function(t,e){return this.moveX(t),this.moveY(e),this}},{key:"moveX",value:function(t){return this.x+=0|t,this}},{key:"moveY",value:function(t){return this.y+=0|t,this}},{key:"setXY",value:function(t,e){return this.setX(t),this.setY(e),this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"resize",value:function(t,e,r,n){var o=t/this.getWidth(),i=e/this.getHeight();return n&&this.moveXY(-this.getX()*o,-this.getY()*i),this.getObject().resize(t,e,r),this}},{key:"crop",value:function(t,e,r,n){var o=this.getObject(),i=function(t,e,r,n,o,i){var a,u,c,f,l,s,y=t.width,p=e.width;for(u=n,f=0;u<n+i&&f<i;u+=1,f+=1)for(a=r,c=0;a<r+o&&c<o;a+=1,c+=1)l=u*y*4+4*a,s=f*p*4+4*c,e.data[s]=t.data[l],e.data[s+1]=t.data[l+1],e.data[s+2]=t.data[l+2],e.data[s+3]=t.data[l+3];return e}(o.getImageData(),new s(r,n).getContext().createImageData(r,n),t,e,r,n);return o.setImageData(i).setWidth(r).setHeight(n),this.setXY(t,e),this}}])&&xa(e.prototype,r),t}();function Ba(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Da(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ta(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Ca=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{backgroundColor:"",blendingMode:""};Ba(this,t),Ta(this,"objects",[]),Ta(this,"effects",[]),Ta(this,"x",0),Ta(this,"y",0),Ta(this,"canvas",null),Ta(this,"imageData",null),Ta(this,"width",0),Ta(this,"height",0),Ta(this,"parameters",{backgroundColor:"",blendingMode:""}),this.initialize(e,r,n),n.backgroundColor&&"transparent"!==n.backgroundColor&&this.applyEffect("fill-color",{color:n.backgroundColor})}var r,n;return r=t,(n=[{key:"initialize",value:function(t,e,r){this.canvas=new s(t,e),this.imageData=this.canvas.getContext().createImageData(t,e),this.width=t,this.height=e,this.parameters=r}},{key:"put",value:function(t,e,r){var n=new Ea(t,this,e,r,{});return this.objects.push(n),n}},{key:"exportLayer",value:function(){for(var t=0;t<this.objects.length;t+=1){var r=this.objects[t];this.imageData=e({width:this.width,height:this.height,imageData:this.imageData},{x:r.getX(),y:r.getY(),width:r.getWidth(),height:r.getHeight(),imageData:r.exportObject()},o)}for(var n=0;n<this.effects.length;n++)this.imageData=this.effects[n].effect.run(this.imageData,this.effects[n].parameters);return this.imageData}},{key:"applyEffect",value:function(t,e){return this.effects.push({name:t,effect:new(Ra.get(t)),parameters:e}),this}},{key:"resize",value:function(t,e,r){this.canvas.destroy(),this.canvas=null,this.imageData=null,this.initialize(t,e,this.parameters);for(var n=0;n<this.objects.length;n+=1)this.objects[n].resize(t,e,r,!0);return this}},{key:"crop",value:function(t,e,r,n){for(var o=0;o<this.objects.length;o+=1)this.objects[o].crop(t,e,r,n);return this}},{key:"moveXY",value:function(t,e){return this.moveX(t),this.moveY(e),this}},{key:"moveX",value:function(t){return this.x+=0|t,this}},{key:"moveY",value:function(t){return this.y+=0|t,this}},{key:"setX",value:function(t){return this.x=t,this}},{key:"setY",value:function(t){return this.y=t,this}},{key:"setBlendingMode",value:function(t){return this.parameters.blendingMode=t,this}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getParameter",value:function(t){return this.parameters[t]}}])&&Da(r.prototype,n),t}();function Ia(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ya(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Aa=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Ia(this,t),Ya(this,"imageData",null),Ya(this,"effects",[]),Ya(this,"layers",[]),Ya(this,"startTime",new Date),Ya(this,"parameters",{}),Ya(this,"width",0),Ya(this,"height",0),Ya(this,"canvas",null),this.initialize(e,r,n)}var n,i;return n=t,(i=[{key:"initialize",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.parameters=r,this.width=t,this.height=e,this.canvas=new s(t,e),this.imageData=this.canvas.getContext().getImageData(0,0,t,e)}},{key:"createLayer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{backgroundColor:"",blendingMode:""},e=new Ca(this.width,this.height,t);return this.layers.push(e),e}},{key:"getTime",value:function(){return(new Date).getTime()-this.startTime.getTime()}},{key:"save",value:function(t){if(c())throw new Error("Available only in node.js environment");for(var n=0;n<this.layers.length;n++)this.imageData=e({width:this.width,height:this.height,imageData:this.imageData},{x:this.layers[n].getX(),y:this.layers[n].getY(),width:this.layers[n].getWidth(),height:this.layers[n].getHeight(),imageData:this.layers[n].exportLayer(),blendingMode:this.layers[n].getParameter("blendingMode")},o);for(var i=0;i<this.effects.length;i++)this.imageData=this.effects[i].effect.run(this.imageData,this.effects[i].parameters);this.canvas.getContext().putImageData(this.imageData,0,0);var a=r(747),u=this.canvas.toDataURL().replace(/^data:image\/\w+;base64,/,""),f=Buffer.from(u,"base64");a.writeFileSync(t,f)}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"image/png";if(!c())throw new Error("Available only in browser environment");for(var r=new window.Image,n=0;n<this.layers.length;n++)this.imageData=e({width:this.width,height:this.height,imageData:this.imageData},{x:this.layers[n].getX(),y:this.layers[n].getY(),width:this.layers[n].getWidth(),height:this.layers[n].getHeight(),imageData:this.layers[n].exportLayer(),blendingMode:this.layers[n].getParameter("blendingMode")},o);for(var i=0;i<this.effects.length;i++)this.imageData=this.effects[i].effect.run(this.imageData,this.effects[i].parameters);return this.canvas.getContext().putImageData(this.imageData,0,0),r.src=this.canvas.toDataURL(t),r}},{key:"applyEffect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.effects.push({name:t,effect:new(Ra.get(t)),parameters:e}),this}},{key:"resize",value:function(t,e,r){this.canvas.destroy(),this.canvas=null,this.imageData=null,this.initialize(t,e);for(var n=0;n<this.layers.length;n+=1)this.layers[n].resize(t,e,r);return this}}])&&Xa(n.prototype,i),t}();function Na(t,e,r,n){var o,i,a,u,c=t.width,f=c/r,l=t.height/n;for(u=0;u<n;u+=1)for(a=0;a<r;a+=1)o=Math.floor(u*l)*c*4+4*Math.floor(a*f),i=u*r*4+4*a,e.data[i+0]=t.data[o+0],e.data[i+1]=t.data[o+1],e.data[i+2]=t.data[o+2],e.data[i+3]=t.data[o+3];return e}function Ga(t,e,r,n){var o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g=t.width,w=t.height,O=g/r,P=w/n;for(v=0;v<n;v+=1)for(m=0;m<r;m+=1)a=v*P,f=(i=m*O)-(u=Math.floor(i)),l=a-(c=Math.floor(a)),(s=u+1)>=g&&(s=u),(y=c+1)>=w&&(y=c),p=4*(c*g+u),h=4*(c*g+s),b=4*(y*g+u),d=4*(y*g+s),o=4*(v*r+m),e.data[o]=(1-l)*((1-f)*t.data[p]+f*t.data[h])+l*((1-f)*t.data[b]+f*t.data[d]),e.data[o+1]=(1-l)*((1-f)*t.data[p+1]+f*t.data[h+1])+l*((1-f)*t.data[b+1]+f*t.data[d+1]),e.data[o+2]=(1-l)*((1-f)*t.data[p+2]+f*t.data[h+2])+l*((1-f)*t.data[b+2]+f*t.data[d+2]),e.data[o+3]=(1-l)*((1-f)*t.data[p+3]+f*t.data[h+3])+l*((1-f)*t.data[b+3]+f*t.data[d+3]);return e}function qa(t,e,r,n){var o,i,a,u,c,f,l,s,y,p,h,b,d,v,m,g,w,O,P,j,_,k,S=function(t,e,r,n){return e+(r-t)*n+(t-2*e+r)*n*n},R=function(t,e,r,n){var o=S(t,e,r,n);return o>255?255:o<0?0:Math.floor(o)},x=t.width,M=x/r,E=t.height/n;for(_=0;_<n;_+=1)for(k=0;k<r;k+=1)i=_*E,y=.5*((o=k*M)-(c=Math.floor(o))),p=.5*(i-(f=Math.floor(i))),h=4*((u=f-1>=0?f-1:f)*x+(a=c-1>=0?c-1:c)),b=4*(u*x+c),d=4*(u*x+(l=c+1>=x?c:c+1)),v=4*(f*x+a),m=4*(f*x+c),g=4*(f*x+l),w=4*((s=f+1>=x?f:f+1)*x+a),O=4*(s*x+c),P=4*(s*x+l),j=4*(_*r+k),e.data[j]=R(S(t.data[h],t.data[b],t.data[d],y),S(t.data[v],t.data[m],t.data[g],y),S(t.data[w],t.data[O],t.data[P],y),p),e.data[j+1]=R(S(t.data[h+1],t.data[b+1],t.data[d+1],y),S(t.data[v+1],t.data[m+1],t.data[g+1],y),S(t.data[w+1],t.data[O+1],t.data[P+1],y),p),e.data[j+2]=R(S(t.data[h+2],t.data[b+2],t.data[d+2],y),S(t.data[v+2],t.data[m+2],t.data[g+2],y),S(t.data[w+2],t.data[O+2],t.data[P+2],y),p),e.data[j+3]=R(S(t.data[h+3],t.data[b+3],t.data[d+3],y),S(t.data[v+3],t.data[m+3],t.data[g+3],y),S(t.data[w+3],t.data[O+3],t.data[P+3],y),p);return e}function La(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ha(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function za(t){return(za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Fa(t,e){return(Fa=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Va(t,e){if(e&&("object"===za(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ua(t)}function Ua(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ja(t){return(Ja=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ka(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Qa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Fa(t,e)}(u,t);var e,n,o,i,a=(o=u,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ja(o);if(i){var r=Ja(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Va(this,t)});function u(){var t;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Ka(Ua(t=a.call(this)),"url",null),Ka(Ua(t),"image",null),c())t.image=new window.Image,t.image.style.position="absolute",t.image.style.left="-99999px",t.image.style.top="-99999px";else{var e=r(338);t.image=new e.Image}return t}return e=u,(n=[{key:"load",value:function(t,e){var n=this,o=function(){n.setWidth(c()?n.image.clientWidth:n.image.width),n.setHeight(c()?n.image.clientHeight:n.image.height),n.canvas=new s(n.getWidth(),n.getHeight()),n.canvas.getContext().drawImage(n.image,0,0,n.getWidth(),n.getHeight()),c()&&document.body.removeChild(n.image),"function"==typeof e&&e.call(n)};if(this.url=t,c())document.body.appendChild(this.image),this.image.onload=function(){o()},this.image.src=t;else{var i=r(747);this.image.src=i.readFileSync(t),o()}}}])&&Wa(e.prototype,n),u}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ha(this,"imageData",null),Ha(this,"canvas",null),Ha(this,"width",0),Ha(this,"height",0)}var e,r;return e=t,(r=[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"setWidth",value:function(t){return this.width=t,this}},{key:"setHeight",value:function(t){return this.height=t,this}},{key:"getImageData",value:function(){return this.imageData||(this.imageData=this.canvas.getContext().getImageData(0,0,this.getWidth(),this.getHeight())),this.imageData}},{key:"setImageData",value:function(t){return this.imageData=t,this}},{key:"resize",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest-neighbour",n=this.getImageData(),o=new s(t,e),i=o.getContext().createImageData(t,e);switch(r){case"nearest-neighbour":i=Na(n,i,t,e);break;case"bilinear-interpolation":i=Ga(n,i,t,e);break;case"biquadratic-interpolation":i=qa(n,i,t,e);break;default:return o.destroy(),this}return o.destroy(),this.setWidth(t).setHeight(e).setImageData(i)}}])&&La(e.prototype,r),t}())})(),module.exports=n})();
//# sourceMappingURL=imagizer.js.map